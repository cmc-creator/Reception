<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destiny Springs | Hub Matrix</title>
    <!-- System Engines -->
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --steampunk-charcoal: #1a1a1a;
            --steampunk-copper: #b87333;
            --steampunk-brass: #c9ae5d;
            --steampunk-bronze: #cd7f32;
            --steampunk-cyan: #00ffff;
            --steampunk-leather: #3e2723;
            --steampunk-gear-shadow: rgba(205, 127, 50, 0.4);
            --steampunk-glow: rgba(0, 255, 255, 0.6);
        }
        
        body[data-theme="steampunk"] {
            background: linear-gradient(135deg, var(--steampunk-charcoal) 0%, #0d0d0d 100%);
            color: #f0e6d2;
            font-family: 'JetBrains Mono', monospace;
        }
        body[data-theme="dark"] {
            background: linear-gradient(135deg, var(--steampunk-charcoal) 0%, #0d0d0d 100%);
            color: #f0e6d2;
            font-family: 'JetBrains Mono', monospace;
        }
        body[data-theme="light"] {
            background: #f4f7fa;
            color: #18182f;
        }
        
        .glass-panel {
            background: linear-gradient(145deg, rgba(62, 39, 35, 0.7), rgba(26, 26, 26, 0.9));
            border: 2px solid var(--steampunk-copper);
            border-radius: 12px;
            box-shadow: 0 8px 32px var(--steampunk-gear-shadow),
                        inset 0 1px 0 rgba(201, 174, 93, 0.3);
            backdrop-filter: blur(4px);
        }
        
        .neon-blue {
            border: 2px solid var(--steampunk-cyan);
            box-shadow: 0 0 20px var(--steampunk-glow),
                        0 0 40px rgba(0, 255, 255, 0.3),
                        inset 0 0 10px rgba(0, 255, 255, 0.1);
        }
        
        .neon-fuchsia {
            border: 2px solid var(--steampunk-brass);
            box-shadow: 0 0 20px rgba(201, 174, 93, 0.6),
                        0 0 40px rgba(201, 174, 93, 0.3),
                        inset 0 0 10px rgba(201, 174, 93, 0.1);
        }
        
        .holo-text {
            text-shadow: 0 0 8px var(--steampunk-cyan),
                         0 0 16px var(--steampunk-cyan),
                         0 2px 4px rgba(0,0,0,0.8);
            color: var(--steampunk-cyan);
            font-weight: 700;
        }
        
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes shrink {
            from { width: 100%; }
            to { width: 0%; }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes gearSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        .fancy-btn {
            background: linear-gradient(135deg, var(--steampunk-copper) 0%, var(--steampunk-bronze) 100%);
            color: #fff;
            border: 2px solid var(--steampunk-brass);
            border-radius: 8px;
            font-weight: 900;
            letter-spacing: 0.1em;
            box-shadow: 0 4px 16px var(--steampunk-gear-shadow),
                        inset 0 1px 0 rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            text-transform: uppercase;
        }
        .fancy-btn:hover {
            background: linear-gradient(135deg, var(--steampunk-bronze) 0%, var(--steampunk-copper) 100%);
            color: var(--steampunk-cyan);
            box-shadow: 0 6px 24px var(--steampunk-gear-shadow),
                        0 0 20px var(--steampunk-glow),
                        inset 0 1px 0 rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .shift-card {
            background: linear-gradient(145deg, rgba(62, 39, 35, 0.6), rgba(26, 26, 26, 0.8));
            border: 1.5px solid var(--steampunk-copper);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(205, 127, 50, 0.3);
            transition: all 0.3s ease;
        }
        .shift-card:hover {
            border-color: var(--steampunk-cyan);
            box-shadow: 0 6px 20px var(--steampunk-glow);
            transform: translateY(-2px);
        }
        
        .day-num {
            color: var(--steampunk-brass);
            font-weight: 900;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        }
        
        .selected-date {
            background: linear-gradient(145deg, rgba(0, 255, 255, 0.15), rgba(0, 255, 255, 0.05));
            border: 2px solid var(--steampunk-cyan);
            box-shadow: 0 0 20px var(--steampunk-glow),
                        inset 0 0 10px rgba(0, 255, 255, 0.2);
        }
        @media (max-width: 900px) {
            .flex, .flex-1, .flex-col, .flex-row, .p-8, .p-10, .w-80, .max-w-2xl, .max-w-md {
                padding: 0.5em !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            .sidebar, .main-grid {
                flex-direction: column !important;
            }
        }
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; color: black !important; }
            .glass-panel, .neon-blue, .neon-fuchsia {
                background: white !important;
                color: black !important;
                border: 1px solid #333 !important;
                box-shadow: none !important;
            }
            .calendar-grid .bg-cyan-600\/80, .calendar-grid .bg-rose-600\/80, .calendar-grid .bg-fuchsia-600\/80, .calendar-grid .bg-blue-600\/80, .calendar-grid .bg-slate-700 {
                color: white !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .calendar-grid .bg-cyan-600\/80 { background: #06b6d4 !important; }
            .calendar-grid .bg-rose-600\/80 { background: #e11d48 !important; }
            .calendar-grid .bg-fuchsia-600\/80 { background: #d946ef !important; }
            .calendar-grid .bg-blue-600\/80 { background: #2563eb !important; }
            .calendar-grid .bg-slate-700 { background: #334155 !important; }
            .calendar-grid .text-white { color: #fff !important; }
            .calendar-grid .text-cyan-400 { color: #0891b2 !important; }
            .calendar-grid .text-rose-500 { color: #e11d48 !important; }
            .calendar-grid .text-fuchsia-400 { color: #d946ef !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- ADMIN CONFIGURATION ---
        const ADMIN_CODE = 'admin123'; // Change this to your desired admin password

        // --- FIREBASE INIT ---
        const firebaseConfig = {
            apiKey: "AIzaSyCmNpRkPR160wYwwmToPDSNFac4iKQXVbo",
            authDomain: "rockstar-reception.firebaseapp.com",
            projectId: "rockstar-reception",
            storageBucket: "rockstar-reception.firebasestorage.app",
            messagingSenderId: "46215930012",
            appId: "1:46215930012:web:e285e0cfe79154c9f18d59",
            measurementId: "G-BFLB72NK0F"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- FIRESTORE DATA LAYER (SHARED) ---
        async function saveToFirestore(collection, doc, data) {
            try {
                await db.collection(collection).doc(doc).set(data);
            } catch (e) {
                console.warn('Firebase unavailable, using localStorage only:', e.message);
            }
        }
        async function loadFromFirestore(collection, doc, defaultValue = null) {
            try {
                const snap = await db.collection(collection).doc(doc).get();
                return snap.exists ? snap.data() : defaultValue;
            } catch (e) {
                console.warn('Firebase unavailable, using localStorage only:', e.message);
                return defaultValue;
            }
        }

        // --- LOCALSTORAGE DATA LAYER ---
        const STORAGE_KEYS = {
            SHIFTS: 'reception_shifts',
            STAFF: 'reception_staff',
            MESSAGES: 'reception_messages',
            REPORTS: 'reception_reports',
            ALERT: 'reception_alert',
            INITIALIZED: 'reception_initialized'
        };

        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.error('Failed to save to localStorage:', e);
            }
        }

        function loadFromStorage(key, defaultValue = null) {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (e) {
                console.error('Failed to load from localStorage:', e);
                return defaultValue;
            }
        }

        function clearAllStorage() {
            Object.values(STORAGE_KEYS).forEach(key => localStorage.removeItem(key));
        }

        // --- ICON SUITE ---
        const IconCalendar = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
        const IconSync = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></svg>;
        const IconPersonnel = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>;
        const IconPlus = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const IconAlert = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>;
        const IconChevronL = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"/></svg>;
        const IconChevronR = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>;
        const IconLock = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const IconTrash = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
        const IconActivity = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>;
        const IconTerminal = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>;

        // --- REPORT FIELDS & TEMPLATES ---
        const REPORT_FIELDS = [
            { id: 'incidents', label: 'üö® Incidents / Alerts', category: 'urgent', placeholder: 'Any incidents, emergencies, or urgent matters that occurred...' },
            { id: 'handoff', label: 'üëã Handoff Notes', category: 'important', placeholder: 'Critical information for the next shift...' },
            { id: 'maintenance', label: 'üîß Maintenance Issues', category: 'important', placeholder: 'Equipment problems, repairs needed...' },
            { id: 'mail', label: 'üì¶ Mail / Deliveries', category: 'normal', placeholder: 'Packages received, mail sorted...' }, 
            { id: 'property', label: 'üè∑Ô∏è Patient Property', category: 'normal', placeholder: 'Property logged, returned, or stored...' },
            { id: 'supplies', label: 'üìã Hub Supplies', category: 'normal', placeholder: 'Inventory status, items restocked...' }, 
            { id: 'lobby', label: 'üè¢ Lobby Status', category: 'normal', placeholder: 'Cleanliness, organization, visitor notes...' },
            { id: 'visitors', label: 'üë• Visitor Log', category: 'normal', placeholder: 'Notable visitors, meetings, appointments...' },
            { id: 'notes', label: 'üìù General Notes', category: 'normal', placeholder: 'Other observations, tasks completed...' }
        ];

        const REPORT_TEMPLATES = [
            { id: 'quiet', label: 'üòå Quiet Shift', content: { incidents: 'No incidents', handoff: 'Routine shift - no urgent items', maintenance: 'No issues', notes: 'Quiet, uneventful shift' }},
            { id: 'busy', label: 'üî• Busy Shift', content: { handoff: 'Multiple activities - see notes', visitors: 'High visitor traffic', notes: 'Busy shift with increased activity' }},
            { id: 'incident', label: '‚ö†Ô∏è Incident Report', content: { incidents: '[TIME] - [DESCRIPTION]\\n[ACTION TAKEN]\\n[FOLLOW-UP NEEDED]', handoff: 'Review incident notes above' }}
        ];

        function initializeSeedData() {
            // Seed staff
            const seedStaff = {
                'unit-karen': { id: 'unit-karen', name: 'Karen', bg: 'bg-cyan-600/80' },
                'unit-izzy': { id: 'unit-izzy', name: 'Izzy', bg: 'bg-rose-600/80' },
                'unit-annalissia': { id: 'unit-annalissia', name: 'Annalissia', bg: 'bg-fuchsia-600/80' },
                'unit-hal': { id: 'unit-hal', name: 'Hal', bg: 'bg-blue-600/80' }
            };
            saveToStorage(STORAGE_KEYS.STAFF, seedStaff);

            // Always seed for February of the current year
            const now = new Date();
            const year = now.getFullYear();
            const month = 1; // February (0-based)
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const shifts = {};
            for (let d = 1; d <= daysInMonth; d++) {
                const date = new Date(year, month, d);
                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const dow = date.getDay();
                // Create sample shifts based on day of week
                if (dow === 1 || dow === 3) { // Mon, Wed
                    shifts[dateKey] = [{ id: `shift-${Date.now()}-${d}-1`, date: dateKey, empId: 'unit-karen', time: '08:00', confirmed: true }];
                } else if (dow === 2 || dow === 4 || dow === 5) { // Tue, Thu, Fri
                    shifts[dateKey] = [{ id: `shift-${Date.now()}-${d}-2`, date: dateKey, empId: 'unit-izzy', time: '08:00', confirmed: true }];
                } else if (dow === 0) { // Sunday
                    shifts[dateKey] = [
                        { id: `shift-${Date.now()}-${d}-3`, date: dateKey, empId: 'unit-hal', time: '16:00', confirmed: true },
                        { id: `shift-${Date.now()}-${d}-4`, date: dateKey, empId: 'unit-annalissia', time: '08:00', confirmed: true }
                    ];
                }
            }
            saveToStorage(STORAGE_KEYS.SHIFTS, shifts);

            // Seed messages
            const seedMessages = [
                { id: 'msg-1', text: 'Welcome to Reception! Your calendar is ready.', user: 'SYSTEM', createdAt: Date.now() - 7200000 },
                { id: 'msg-2', text: 'All data is stored locally in your browser.', user: 'SYSTEM', createdAt: Date.now() - 3600000 },
                { id: 'msg-3', text: 'Use the Export Matrix button to print or save your schedule.', user: 'INFO', createdAt: Date.now() }
            ];
            saveToStorage(STORAGE_KEYS.MESSAGES, seedMessages);

            // Seed report data for today
            const today = now.toISOString().split('T')[0];
            const seedReports = {
                [today]: {
                    mail: 'Sample: Mail delivery expected at 2 PM',
                    property: 'Sample: All patient property secured',
                    supplies: 'Sample: Stock levels normal',
                    lobby: 'Sample: Clean and organized',
                    aoc: 'Sample: All systems operational'
                }
            };
            saveToStorage(STORAGE_KEYS.REPORTS, seedReports);

            // Seed alert
            saveToStorage(STORAGE_KEYS.ALERT, 'Welcome to Reception - Your offline staff calendar');

            // Mark as initialized
            saveToStorage(STORAGE_KEYS.INITIALIZED, true);
        }

        function App() {
            // --- Application State ---
            const [currentDate, setCurrentDate] = useState(() => {
                const now = new Date();
                return new Date(now.getFullYear(), now.getMonth(), 1);
            });
            const [selectedDate, setSelectedDate] = useState(() => new Date().toISOString().split('T')[0]);
            const [events, setEvents] = useState({});
            const [staff, setStaff] = useState({});
            const [messages, setMessages] = useState([]);
            const [reportData, setReportData] = useState({});
            // Daily checklist state
            const [checklist, setChecklist] = useState(() => loadFromStorage('reception_checklist_' + selectedDate, []));
            const [newChecklistItem, setNewChecklistItem] = useState('');
            const [globalAlert, setGlobalAlert] = useState('');
            const [isPersonnelModalOpen, setIsPersonnelModalOpen] = useState(false);
            const [isAddModalOpen, setIsAddModalOpen] = useState(false);
            const [editingShift, setEditingShift] = useState(null);
            const [adminCode, setAdminCode] = useState('');
            const [isAdminAuth, setIsAdminAuth] = useState(false);
            const [chatInput, setChatInput] = useState('');
            const [newStaffName, setNewStaffName] = useState('');
            const [newStaffColor, setNewStaffColor] = useState('#0891b2');
            const chatEndRef = useRef(null);

            // --- Toast Notifications ---
            const [toasts, setToasts] = useState([]);
            function showNotification(msg, type = 'info') {
                const id = Date.now();
                setToasts(t => [...t, { id, msg, type }]);
                setTimeout(() => {
                    setToasts(t => t.filter(toast => toast.id !== id));
                }, 4000);
            }
            function dismissToast(id) {
                setToasts(t => t.filter(toast => toast.id !== id));
            }

            // --- Shift Templates ---
            const [shiftTemplates, setShiftTemplates] = useState(() => loadFromStorage('shift_templates', [
                { id: 't1', name: 'Morning Shift', start: '08:00', end: '14:00' },
                { id: 't2', name: 'Afternoon Shift', start: '14:00', end: '20:00' },
                { id: 't3', name: 'Full Day', start: '08:00', end: '20:00' }
            ]));
            const [showTemplateModal, setShowTemplateModal] = useState(false);

            // --- Enhanced Shift Reports ---
            const [reportPriority, setReportPriority] = useState(() => loadFromStorage('report_priority_' + selectedDate, 'normal'));
            const [reportAttachments, setReportAttachments] = useState(() => loadFromStorage('report_attachments_' + selectedDate, []));
            const [showReportHistory, setShowReportHistory] = useState(false);
            const [allReports, setAllReports] = useState({});

            // --- View Modes ---
            const [viewMode, setViewMode] = useState('month');

            // --- Drag & Drop ---
            const [draggedStaff, setDraggedStaff] = useState(null);
            const [draggedShift, setDraggedShift] = useState(null);
            const [dragOverDate, setDragOverDate] = useState(null);

            // --- Hospital Emergency Features ---
            const [showPanicAlert, setShowPanicAlert] = useState(false);
            const [showDeescalation, setShowDeescalation] = useState(false);
            const [panicAlerts, setPanicAlerts] = useState(() => loadFromStorage('panic_alerts', []));

            // --- Team Morale Features ---
            const [showAchievements, setShowAchievements] = useState(false);
            const [showKudos, setShowKudos] = useState(false);
            const [kudosWall, setKudosWall] = useState(() => loadFromStorage('kudos_wall', []));
            const [motivationalQuote] = useState(() => {
                const quotes = [
                    { text: "You make a difference every single day.", author: "Your Team" },
                    { text: "Crisis doesn't build character, it reveals it.", author: "Unknown" },
                    { text: "Caring for others is the highest expression of humanity.", author: "Unknown" },
                    { text: "In the middle of difficulty lies opportunity.", author: "Einstein" },
                    { text: "Be the calm in someone's storm.", author: "Unknown" },
                    { text: "Small acts of kindness create ripples of healing.", author: "Unknown" }
                ];
                return quotes[Math.floor(Math.random() * quotes.length)];
            });

            // --- Initialize theme on mount ---
            useEffect(() => {
                const savedTheme = localStorage.getItem('reception_theme') || 'steampunk';
                document.body.setAttribute('data-theme', savedTheme);
            }, []);

            // --- Initialize Data from localStorage ---
            useEffect(() => {
                // Check if app has been initialized before
                const initialized = loadFromStorage(STORAGE_KEYS.INITIALIZED);
                
                if (!initialized) {
                    // First load - initialize with seed data
                    initializeSeedData();
                }

                // Load data from localStorage
                loadDataFromStorage();
            }, []);

            function loadDataFromStorage() {
                const loadedShifts = loadFromStorage(STORAGE_KEYS.SHIFTS, {});
                const loadedStaff = loadFromStorage(STORAGE_KEYS.STAFF, {});
                const loadedMessages = loadFromStorage(STORAGE_KEYS.MESSAGES, []);
                const loadedAlert = loadFromStorage(STORAGE_KEYS.ALERT, '');
                
                setEvents(loadedShifts);
                setStaff(loadedStaff);
                setMessages(loadedMessages);
                setGlobalAlert(loadedAlert);
            }

            // --- Load report data and checklist when selected date changes ---
            useEffect(() => {
                const allReports = loadFromStorage(STORAGE_KEYS.REPORTS, {});
                setReportData(allReports[selectedDate] || {});
                setChecklist(loadFromStorage('reception_checklist_' + selectedDate, []));
            }, [selectedDate]);

            // --- FIRESTORE SYNC HOOKS ---
            // Load shared shifts and staff from Firestore on mount
            useEffect(() => {
                async function fetchSharedData() {
                    const loadedShifts = await loadFromFirestore('shared', 'shifts', {});
                    const loadedStaff = await loadFromFirestore('shared', 'staff', {});
                    setEvents(loadedShifts);
                    setStaff(loadedStaff);
                }
                fetchSharedData();
            }, []);

            // Save shifts to Firestore when events change
            useEffect(() => {
                if (Object.keys(events).length > 0) {
                    saveToFirestore('shared', 'shifts', events);
                }
            }, [events]);

            // Save staff to Firestore when staff changes
            useEffect(() => {
                if (Object.keys(staff).length > 0) {
                    saveToFirestore('shared', 'staff', staff);
                }
            }, [staff]);

            // --- Admin Master Reset Pattern ---
            // --- Baseline Save/Restore ---
            function saveBaseline() {
                // Save current staff and shifts as baseline for the current month
                const mIdx = currentDate.getMonth(), yIdx = currentDate.getFullYear();
                const key = `baseline_${yIdx}_${String(mIdx+1).padStart(2,'0')}`;
                const baseline = {
                    staff,
                    shifts: events
                };
                saveToStorage(key, baseline);
                alert('Baseline for this month saved!');
            }

            function restoreBaseline() {
                const mIdx = currentDate.getMonth(), yIdx = currentDate.getFullYear();
                const key = `baseline_${yIdx}_${String(mIdx+1).padStart(2,'0')}`;
                const baseline = loadFromStorage(key);
                if (!baseline) {
                    alert('No baseline saved for this month.');
                    return;
                }
                setStaff(baseline.staff);
                setEvents(baseline.shifts);
                saveToStorage(STORAGE_KEYS.STAFF, baseline.staff);
                saveToStorage(STORAGE_KEYS.SHIFTS, baseline.shifts);
                alert('Baseline restored for this month!');
            }

            function handleMasterReset() {
                const year = new Date().getFullYear();
                if (!confirm(`ADMIN MASTER RESET: Restore personnel Karen, Izzy, Annalissia, and Hal and force February ${year} Baseline schedule?`)) return;
                // Clear all data and re-initialize
                clearAllStorage();
                initializeSeedData();
                loadDataFromStorage();
                alert('Master reset complete!');
            }

            // --- UI Elements ---
            const [shiftStatusFilter, setShiftStatusFilter] = useState('all');
            const [shiftSearch, setShiftSearch] = useState('');
            const calendarMatrix = useMemo(() => {
                const mIdx = currentDate.getMonth(), yIdx = currentDate.getFullYear();
                const total = new Date(yIdx, mIdx + 1, 0).getDate();
                const start = new Date(yIdx, mIdx, 1).getDay();
                const cells = [];
                // CALENDAR TALLER: min-h bumped to 180px
                for (let i = 0; i < start; i++) cells.push(<div key={`e-${i}`} className="min-h-[180px] bg-white/[0.01] border border-white/[0.03]" />);
                for (let d = 1; d <= total; d++) {
                    const dk = `${yIdx}-${String(mIdx + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                    let dayShifts = events[dk] || [];
                    if (shiftStatusFilter === 'confirmed') dayShifts = dayShifts.filter(s => s.confirmed);
                    if (shiftStatusFilter === 'pending') dayShifts = dayShifts.filter(s => !s.confirmed);
                    if (shiftSearch.trim()) {
                        const search = shiftSearch.trim().toLowerCase();
                        dayShifts = dayShifts.filter(s => {
                            const emp = staff[s.empId]?.name?.toLowerCase() || '';
                            return emp.includes(search) || dk.includes(search);
                        });
                    }
                    const isToday = new Date().toISOString().split('T')[0] === dk;
                    cells.push(
                        <div key={dk} onClick={() => setSelectedDate(dk)} className={`min-h-[180px] p-3 border border-white/[0.05] transition-all cursor-pointer relative group ${selectedDate === dk ? 'bg-cyan-500/10 ring-1 ring-cyan-400 shadow-inner' : 'bg-white/[0.01] hover:bg-white/[0.03]'} ${isToday ? 'border-l-2 border-l-cyan-400' : ''}`}>
                            <div className="flex justify-between items-start">
                                <span className={`text-xl font-black tracking-tighter ${selectedDate === dk ? 'text-cyan-400' : 'text-slate-600'}`}>{d}</span>
                                <button onClick={(e) => { e.stopPropagation(); setSelectedDate(dk); setIsAddModalOpen(true); }} className="p-1 opacity-20 hover:opacity-100 transition-opacity"><IconPlus /></button>
                            </div>
                            <div className="space-y-2 mt-4">
                                {dayShifts.length === 0 ? <div className="text-[10px] font-black text-rose-500 animate-pulse uppercase flex items-center gap-1 mt-2 text-left font-mono italic"><IconAlert /> Needs Coverage</div> : 
                                    dayShifts.map(s => (
                                        <div key={s.id} onClick={(e) => { e.stopPropagation(); setEditingShift(s); }} 
                                            className={`text-[13px] p-2 rounded-xl font-bold truncate text-white ${staff[s.empId]?.bg || 'bg-slate-700'} uppercase flex flex-col justify-between text-left shadow-2xl border border-white/10 group-hover:scale-105 transition-transform cursor-pointer`}>
                                            <div className="flex items-center justify-between">
                                                <span>{staff[s.empId]?.name || '...'}</span>
                                                <span className="opacity-50 text-[10px] font-mono shrink-0">{(s.start || s.time) + (s.end ? ` - ${s.end}` : '')}</span>
                                            </div>
                                        </div>
                                    ))
                                }
                            </div>
                        </div>
                    );
                }
                return cells;
            }, [currentDate, events, selectedDate, staff, shiftStatusFilter, shiftSearch]);

            return (
                <div className="flex h-screen w-screen bg-black overflow-hidden text-xs">
                    {/* NAV RAIL */}
                    <nav className="no-print w-16 bg-[#050505] border-r border-white/5 flex flex-col items-center py-8 gap-10">
                        <div className="text-cyan-400 font-black text-xl holo-text">DS</div>
                        
                        {/* PANIC BUTTON */}
                        <button 
                            onClick={() => {
                                setShowPanicAlert(true);
                                const alert = {
                                    id: Date.now(),
                                    user: 'Reception',
                                    timestamp: new Date().toISOString(),
                                    location: 'Reception Desk',
                                    resolved: false
                                };
                                const updated = [alert, ...panicAlerts];
                                setPanicAlerts(updated);
                                saveToStorage('panic_alerts', updated);
                                showNotification('üö® EMERGENCY ALERT SENT');
                            }}
                            className="bg-red-600 p-4 rounded-full transition-all hover:scale-110 hover:bg-red-500 shadow-lg shadow-red-500/50 animate-pulse"
                            title="EMERGENCY ALERT"
                        >
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="white" stroke="white" strokeWidth="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="12" y1="8" x2="12" y2="12"/>
                                <line x1="12" y1="16" x2="12.01" y2="16"/>
                            </svg>
                        </button>
                        
                        {/* De-escalation Quick Reference */}
                        <button 
                            onClick={() => setShowDeescalation(true)}
                            className="bg-purple-600 p-3 rounded-xl transition-all hover:scale-110 hover:bg-purple-500"
                            title="De-escalation Scripts"
                        >
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                            </svg>
                        </button>
                        
                        {/* Team Kudos */}
                        <button 
                            onClick={() => setShowKudos(true)}
                            className="bg-pink-600 p-3 rounded-xl transition-all hover:scale-110 hover:bg-pink-500"
                            title="Kudos Wall"
                        >
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                            </svg>
                        </button>
                        
                        {/* Achievements */}
                        <button 
                            onClick={() => setShowAchievements(true)}
                            className="bg-yellow-600 p-3 rounded-xl transition-all hover:scale-110 hover:bg-yellow-500"
                            title="Team Achievements"
                        >
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
                            </svg>
                        </button>
                        
                        <button onClick={handleMasterReset} className="p-3 bg-cyan-500/10 rounded-xl border border-cyan-500/30 transition-all shadow-inner hover:scale-110" title="Admin Master Reset"><IconSync /></button>
                        <button onClick={saveBaseline} className="p-3 bg-emerald-500/10 rounded-xl border border-emerald-500/30 transition-all shadow-inner hover:scale-110" title="Save Baseline for Month">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                        </button>
                        <button onClick={restoreBaseline} className="p-3 bg-yellow-500/10 rounded-xl border border-yellow-500/30 transition-all shadow-inner hover:scale-110" title="Restore Baseline for Month">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>
                        </button>
                        <button onClick={() => setIsPersonnelModalOpen(true)} className="p-3 bg-fuchsia-500/10 rounded-xl border border-fuchsia-500/30 transition-all hover:scale-110" title="Personnel Manifest"><IconPersonnel /></button>
                        <div className="mt-auto flex flex-col items-center gap-3">
                            <div className="w-2.5 h-2.5 rounded-full status-pulse bg-emerald-500 shadow-[0_0_10px_#10b981]" title="Local Storage Ready" />
                            <div className="opacity-10 text-[8px] font-black uppercase rotate-90 tracking-widest font-mono">Protocol</div>
                        </div>
                    </nav>

                    <div className="flex-1 flex flex-col">
                        <header className="no-print h-10 bg-rose-950/20 border-b border-rose-500/30 flex items-center px-6 gap-4 text-left font-bold">
                            <div className="flex items-center gap-2 text-rose-500 font-black text-[9px] uppercase tracking-widest alert-pulse shrink-0"><IconAlert /> Critical Intel</div>
                            <input value={globalAlert} onChange={e => { 
                                const newAlert = String(e.target.value);
                                setGlobalAlert(newAlert);
                                saveToStorage(STORAGE_KEYS.ALERT, newAlert);
                            }} className="flex-1 bg-transparent border-none text-[11px] font-bold text-white outline-none placeholder-rose-900" placeholder="Broadcast immediate hub directive..." />
                            <button className="fancy-btn ml-4" onClick={() => {
                                const currentTheme = document.body.getAttribute('data-theme') || 'steampunk';
                                const theme = currentTheme === 'steampunk' ? 'light' : 'steampunk';
                                document.body.setAttribute('data-theme', theme);
                                localStorage.setItem('reception_theme', theme);
                            }}>
                                Toggle {(document.body.getAttribute('data-theme') || 'steampunk') === 'steampunk' ? 'Light' : 'Steampunk'} Mode
                            </button>
                        </header>

                        <div className="flex-1 flex overflow-hidden">
                            {/* SIDEBAR LOGS */}
                            <aside className="no-print w-80 bg-[#080808] border-r border-white/5 p-5 flex flex-col gap-4 overflow-y-auto no-scrollbar">
                                <header className="text-left mb-2 text-white font-black">
                                    <h1 className="text-lg tracking-tighter holo-text uppercase">Shift Report</h1>
                                    <div className="text-[10px] text-cyan-400 font-bold uppercase mt-1 tracking-widest font-mono">{selectedDate}</div>
                                </header>
                                <div className="space-y-3">
                                    {REPORT_FIELDS.map(f => (
                                        <div key={f.id} className="glass-panel neon-fuchsia p-3 text-left font-bold">
                                            <label className="text-[9px] font-black text-fuchsia-400 uppercase tracking-widest mb-1 block flex items-center gap-2 font-bold font-mono"><IconActivity /> {f.label}</label>
                                            <textarea value={String(reportData[f.id] || '')} onChange={e => {
                                                const newReportData = { ...reportData, [f.id]: e.target.value };
                                                setReportData(newReportData);
                                                const allReports = loadFromStorage(STORAGE_KEYS.REPORTS, {});
                                                allReports[selectedDate] = newReportData;
                                                saveToStorage(STORAGE_KEYS.REPORTS, allReports);
                                            }} className="w-full bg-transparent border-none text-xs text-white h-14 outline-none resize-none font-bold" placeholder="..." />
                                        </div>
                                    ))}
                                </div>
                                <div className="glass-panel neon-blue p-3 rounded-lg mt-4 text-left flex flex-col">
                                    <label className="text-[9px] font-black text-cyan-400 uppercase tracking-widest mb-2 block flex items-center gap-2 font-mono tracking-widest font-bold"><IconActivity className="inline mr-2"/>Daily Checklist</label>
                                    <div className="flex flex-col gap-1 mb-2">
                                        {checklist.length === 0 && <div className="text-[10px] text-slate-400 italic">No tasks yet for this day.</div>}
                                        {checklist.map((item, idx) => (
                                            <div key={idx} className="flex items-center gap-2 group">
                                                <input type="checkbox" checked={!!item.checked} onChange={e => {
                                                    const updated = checklist.map((it, i) => i === idx ? { ...it, checked: !it.checked } : it);
                                                    setChecklist(updated);
                                                    saveToStorage('reception_checklist_' + selectedDate, updated);
                                                }} />
                                                <span className={`text-[11px] flex-1 ${item.checked ? 'line-through text-slate-500' : ''}`}>{item.text}</span>
                                                <button onClick={() => {
                                                    const updated = checklist.filter((_, i) => i !== idx);
                                                    setChecklist(updated);
                                                    saveToStorage('reception_checklist_' + selectedDate, updated);
                                                }} className="text-rose-400 text-xs font-bold opacity-60 hover:opacity-100">&times;</button>
                                            </div>
                                        ))}
                                    </div>
                                    <form onSubmit={e => {
                                        e.preventDefault();
                                        if (!newChecklistItem.trim()) return;
                                        const updated = [...checklist, { text: newChecklistItem, checked: false }];
                                        setChecklist(updated);
                                        saveToStorage('reception_checklist_' + selectedDate, updated);
                                        setNewChecklistItem('');
                                    }} className="flex gap-1 mb-2">
                                        <input value={newChecklistItem} onChange={e => setNewChecklistItem(e.target.value)} className="flex-1 bg-black border border-cyan-500/30 rounded p-1.5 text-[10px] outline-none text-white font-bold" placeholder="Add task..." />
                                        <button type="submit" className="bg-cyan-600 px-2 rounded text-white font-bold transition-all hover:bg-cyan-500 uppercase font-black tracking-widest">Add</button>
                                    </form>
                                </div>
                                <div className="glass-panel neon-blue p-3 rounded-lg mt-auto text-left flex flex-col h-48">
                                    <label className="text-[9px] font-black text-cyan-400 uppercase tracking-widest mb-2 block flex items-center gap-2 font-mono tracking-widest font-bold"><IconTerminal className="inline mr-2"/>Live Intel Feed</label>
                                    <div className="flex-1 overflow-y-auto space-y-1.5 mb-2 text-[10px] no-scrollbar text-slate-300 font-medium">
                                        {messages.map(m => <div key={m.id}><span className="text-cyan-500 font-black mr-1 uppercase">{String(m.user)}:</span>{String(m.text)}</div>)}
                                        <div ref={chatEndRef} />
                                    </div>
                                    <form onSubmit={e => { 
                                        e.preventDefault(); 
                                        if (chatInput.trim()) { 
                                            const newMessage = { 
                                                id: `msg-${Date.now()}`, 
                                                text: chatInput, 
                                                createdAt: Date.now(), 
                                                user: 'USER' 
                                            };
                                            const updatedMessages = [...messages, newMessage].sort((a,b) => (a.createdAt || 0) - (b.createdAt || 0));
                                            setMessages(updatedMessages);
                                            saveToStorage(STORAGE_KEYS.MESSAGES, updatedMessages);
                                            setChatInput('');
                                            setTimeout(() => chatEndRef.current?.scrollIntoView({ behavior: "smooth" }), 100);
                                        }
                                    }} className="flex gap-1 shrink-0 pt-2 text-left">
                                        <input value={chatInput} onChange={e => setChatInput(e.target.value)} className="flex-1 bg-black border border-cyan-500/30 rounded p-1.5 text-[10px] outline-none text-white font-bold" placeholder="Broadcast..." />
                                        <button type="submit" className="bg-cyan-600 px-2 rounded text-white font-bold transition-all hover:bg-cyan-500 uppercase font-black tracking-widest">OK</button>
                                    </form>
                                </div>
                            </aside>

                            {/* MAIN GRID */}
                            <main className="flex-1 p-8 overflow-y-auto no-scrollbar text-center font-bold">
                                <div className="flex justify-between items-end mb-8 no-print text-left font-bold">
                                    <div className="text-white">
                                        <h2 className="text-5xl font-black uppercase tracking-tighter drop-shadow-[0_0_15px_rgba(255,255,255,0.2)] font-black">
                                            {currentDate.toLocaleDateString(undefined, { month: 'long', year: 'numeric' })}
                                        </h2>
                                        <div className="text-[10px] font-black text-cyan-400 tracking-[0.5em] uppercase mt-1">Matrix Interface Alpha</div>
                                    </div>
                                    <div className="flex gap-4 items-center">
                                        <input value={shiftSearch} onChange={e => setShiftSearch(e.target.value)} placeholder="Search by employee or date" className="bg-black border border-cyan-500/30 text-cyan-400 rounded-xl px-2 py-1 text-xs font-bold ml-2 w-48" />
                                        <div className="flex bg-white/5 rounded-xl border border-white/10 p-1 text-white font-bold">
                                            <button onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1))} className="p-2 hover:text-cyan-400 transition-colors border-r border-white/5 uppercase font-bold text-[10px]"><IconChevronL /></button>
                                            <button onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1))} className="p-2 hover:text-cyan-400 transition-colors uppercase font-bold text-[10px]"><IconChevronR /></button>
                                        </div>
                                        <select value={shiftStatusFilter} onChange={e => setShiftStatusFilter(e.target.value)} className="bg-black border border-cyan-500/30 text-cyan-400 rounded-xl px-2 py-1 text-xs font-bold ml-2">
                                            <option value="all">All</option>
                                            <option value="confirmed">Confirmed</option>
                                            <option value="pending">Pending</option>
                                        </select>
                                        <button onClick={() => window.print()} className="bg-cyan-500 text-black px-6 py-2 rounded-xl font-black text-xs uppercase shadow-lg hover:bg-white transition-all font-bold">Export Matrix</button>
                                        <button
                                            onClick={() => {
                                                // Gather all shifts for the current month
                                                const mIdx = currentDate.getMonth(), yIdx = currentDate.getFullYear();
                                                const total = new Date(yIdx, mIdx + 1, 0).getDate();
                                                let rows = [['Date','Employee','Start','End','Status','Note']];
                                                for (let d = 1; d <= total; d++) {
                                                    const dk = `${yIdx}-${String(mIdx + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                                                    const dayShifts = events[dk] || [];
                                                    dayShifts.forEach(s => {
                                                        rows.push([
                                                            dk,
                                                            staff[s.empId]?.name || s.empId,
                                                            s.start || s.time || '',
                                                            s.end || '',
                                                            s.confirmed ? 'Confirmed' : 'Pending',
                                                            s.note ? s.note.replace(/\n/g, ' ') : ''
                                                        ]);
                                                    });
                                                }
                                                const csv = rows.map(r => r.map(x => '"'+String(x).replace(/"/g,'""')+'"').join(',')).join('\r\n');
                                                const blob = new Blob([csv], { type: 'text/csv' });
                                                const url = URL.createObjectURL(blob);
                                                const a = document.createElement('a');
                                                a.href = url;
                                                a.download = `reception_shifts_${yIdx}_${String(mIdx+1).padStart(2,'0')}.csv`;
                                                document.body.appendChild(a);
                                                a.click();
                                                setTimeout(() => { document.body.removeChild(a); URL.revokeObjectURL(url); }, 100);
                                            }}
                                            className="bg-cyan-700 text-white px-6 py-2 rounded-xl font-black text-xs uppercase shadow-lg hover:bg-cyan-500 transition-all font-bold"
                                        >Export CSV</button>
                                    </div>
                                </div>
                                <div className="grid grid-cols-7 glass-panel overflow-hidden neon-blue rounded-xl font-bold">
                                    {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(d => <div key={d} className="py-4 text-center text-[10px] font-black text-cyan-400/60 uppercase tracking-widest border-b border-white/5 bg-white/[0.02]">{d}</div>)}
                                    {calendarMatrix}
                                </div>
                            </main>
                        </div>
                    </div>

                    {/* MODAL: PERSONNEL */}
                    {isPersonnelModalOpen && (
                        <div className="fixed inset-0 bg-black/98 backdrop-blur-2xl z-[600] flex items-center justify-center p-4">
                            <div className="glass-panel neon-fuchsia p-10 w-full max-w-2xl max-h-[85vh] flex flex-col shadow-2xl rounded-[2rem]">
                                <div className="flex justify-between items-center mb-8 text-fuchsia-400 text-left">
                                    <h3 className="text-3xl font-black uppercase tracking-tighter">Manifest Hub</h3>
                                    <button onClick={() => { setIsPersonnelModalOpen(false); setIsAdminAuth(false); }} className="text-5xl font-light hover:text-white transition-colors">&times;</button>
                                </div>
                                {!isAdminAuth ? (
                                    <form onSubmit={e => { e.preventDefault(); if (adminCode === ADMIN_CODE) setIsAdminAuth(true); }} className="space-y-6 flex-1 flex flex-col justify-center items-center text-center font-bold">
                                        <div className="text-fuchsia-500 font-black text-xl flex items-center gap-3 alert-pulse">Restricted Access<br/><span className="text-[10px] opacity-40 uppercase tracking-widest font-bold font-mono"><IconLock className="inline mr-2"/> Code Required</span></div>
                                        <input type="password" value={adminCode} onChange={e => setAdminCode(e.target.value)} className="w-48 bg-black border border-fuchsia-500/40 rounded-xl p-4 text-center text-3xl text-white outline-none shadow-inner font-black" placeholder="****" autoFocus />
                                        <button type="submit" className="bg-fuchsia-600 px-12 py-3 rounded-xl font-black uppercase text-xs text-white shadow-lg transition-all hover:scale-105 active:scale-95 font-bold tracking-widest">Unlock Manifest</button>
                                    </form>
                                ) : (
                                    <div className="flex flex-col flex-1 overflow-hidden text-left font-bold">
                                        <div className="space-y-4 mb-8 text-white text-left font-bold font-mono">
                                            <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Enroll New Unit</label>
                                            <div className="flex gap-3 items-center">
                                                <input value={newStaffName} onChange={e => setNewStaffName(e.target.value)} className="flex-1 bg-black border border-white/10 rounded-xl p-3 text-sm text-white font-black outline-none focus:border-fuchsia-500 font-bold" placeholder="Identity Label..." />
                                                <input type="color" value={newStaffColor} onChange={e => setNewStaffColor(e.target.value)} className="w-10 h-10 p-0 border-none bg-transparent cursor-pointer" title="Pick color" />
                                                <button onClick={() => { 
                                                    if (!newStaffName.trim()) return; 
                                                    const newId = `staff-${Date.now()}`;
                                                    const color = newStaffColor || '#0891b2';
                                                    const newStaff = { id: newId, name: String(newStaffName), bg: '', color, createdAt: Date.now() };
                                                    const updatedStaff = { ...staff, [newId]: newStaff };
                                                    setStaff(updatedStaff);
                                                    saveToStorage(STORAGE_KEYS.STAFF, updatedStaff);
                                                    setNewStaffName('');
                                                    setNewStaffColor('#0891b2');
                                                }} className="bg-fuchsia-600 px-6 rounded-xl font-black uppercase text-xs text-white shadow-lg transition-all hover:bg-fuchsia-500 font-bold tracking-widest">Enroll</button>
                                            </div>
                                        </div>
                                        <div className="flex-1 overflow-y-auto no-scrollbar space-y-2 pr-2 border-t border-white/5 pt-4 text-white text-left font-bold">
                                            {Object.entries(staff).map(([id, s]) => (
                                                <div key={id} className="flex items-center justify-between p-3 glass-panel neon-blue rounded-xl group border-white/5 transition-all hover:bg-white/[0.03]">
                                                    <div className="flex items-center gap-4 text-left font-bold font-mono">
                                                        <div className="w-3 h-3 rounded-full shadow-white/20" style={{ background: s.color || '#0891b2' }} />
                                                        <span className="font-black uppercase text-sm">{String(s.name)}</span>
                                                        <input type="color" value={s.color || '#0891b2'} onChange={e => {
                                                            const updatedStaff = { ...staff, [id]: { ...s, color: e.target.value } };
                                                            setStaff(updatedStaff);
                                                            saveToStorage(STORAGE_KEYS.STAFF, updatedStaff);
                                                        }} className="w-6 h-6 ml-2 p-0 border-none bg-transparent cursor-pointer" title="Change color" />
                                                    </div>
                                                    <button onClick={() => { 
                                                        if (!confirm("Terminate unit identifier?")) return;
                                                        const updatedStaff = { ...staff };
                                                        delete updatedStaff[id];
                                                        setStaff(updatedStaff);
                                                        saveToStorage(STORAGE_KEYS.STAFF, updatedStaff);
                                                        // Also remove shifts for this staff member
                                                        const updatedEvents = { ...events };
                                                        Object.keys(updatedEvents).forEach(date => {
                                                            updatedEvents[date] = updatedEvents[date].filter(shift => shift.empId !== id);
                                                            if (updatedEvents[date].length === 0) delete updatedEvents[date];
                                                        });
                                                        setEvents(updatedEvents);
                                                        saveToStorage(STORAGE_KEYS.SHIFTS, updatedEvents);
                                                    }} className="text-rose-500 font-black text-[9px] uppercase px-3 py-1 hover:bg-rose-500/10 rounded-lg border border-rose-500/30 font-mono font-bold tracking-widest">PURGE</button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* ASSIGN MODAL */}
                    {isAddModalOpen && (
                        <div className="fixed inset-0 bg-black/90 backdrop-blur-md z-[500] flex items-center justify-center p-4 text-left font-bold text-white">
                            <div className="glass-panel neon-blue p-10 w-full max-w-md shadow-2xl rounded-3xl">
                                <h3 className="text-2xl font-black text-cyan-400 uppercase mb-8 tracking-tighter text-left font-mono font-bold">Deploy Identity</h3>
                                {/* Step 1: Select Employee */}
                                {!window.selectedAddEmpId && (
                                    <div className="grid grid-cols-2 gap-2 mb-8">
                                        {Object.entries(staff).map(([id, s]) => (
                                            <button key={id} onClick={() => { window.selectedAddEmpId = id; window.selectedAddEmpName = s.name; window.selectedAddEmpBg = s.bg; window.selectedAddTime = '08:00'; setIsAddModalOpen(false); setTimeout(() => setIsAddModalOpen(true), 10); }} className={`p-4 rounded-xl text-[14px] font-black uppercase text-white ${s.bg || 'bg-slate-700'} hover:scale-105 transition-all shadow-lg font-black`}>
                                                {String(s.name)}
                                            </button>
                                        ))}
                                    </div>
                                )}
                                {/* Step 2: Enter Shift Time */}
                                {window.selectedAddEmpId && (
                                    <form onSubmit={e => {
                                        e.preventDefault();
                                        const newShift = {
                                            id: `shift-${Date.now()}`,
                                            date: selectedDate,
                                            empId: window.selectedAddEmpId,
                                            start: window.selectedAddStart || '08:00',
                                            end: window.selectedAddEnd || '20:00',
                                            confirmed: true,
                                            createdAt: Date.now()
                                        };
                                        const updatedEvents = { ...events };
                                        if (!updatedEvents[selectedDate]) updatedEvents[selectedDate] = [];
                                        updatedEvents[selectedDate].push(newShift);
                                        setEvents(updatedEvents);
                                        saveToStorage(STORAGE_KEYS.SHIFTS, updatedEvents);
                                        setIsAddModalOpen(false);
                                        window.selectedAddEmpId = null;
                                        window.selectedAddEmpName = null;
                                        window.selectedAddEmpBg = null;
                                        window.selectedAddStart = null;
                                        window.selectedAddEnd = null;
                                    }} className="space-y-6">
                                        <div className="mb-4 flex items-center gap-3">
                                            <div className={`w-4 h-4 rounded-full ${window.selectedAddEmpBg || 'bg-slate-700'} shadow-white/20`} />
                                            <span className="font-black uppercase text-lg">{window.selectedAddEmpName}</span>
                                        </div>
                                        <label className="block text-xs text-cyan-400 font-bold mb-1">Start Time</label>
                                        <input type="time" value={window.selectedAddStart || '08:00'} onChange={e => { window.selectedAddStart = e.target.value; setIsAddModalOpen(false); setTimeout(() => setIsAddModalOpen(true), 10); }} className="w-full bg-black border border-cyan-500/40 rounded-xl p-3 text-center text-lg text-white outline-none shadow-inner font-black" required />
                                        <label className="block text-xs text-cyan-400 font-bold mb-1">End Time</label>
                                        <input type="time" value={window.selectedAddEnd || '20:00'} onChange={e => { window.selectedAddEnd = e.target.value; setIsAddModalOpen(false); setTimeout(() => setIsAddModalOpen(true), 10); }} className="w-full bg-black border border-cyan-500/40 rounded-xl p-3 text-center text-lg text-white outline-none shadow-inner font-black" required />
                                        <div className="flex gap-3 mt-6">
                                            <button type="submit" className="flex-1 bg-cyan-600 py-3 rounded-xl font-black uppercase text-xs text-white shadow-lg transition-all hover:bg-cyan-500 font-bold tracking-widest">Assign Shift</button>
                                            <button type="button" onClick={() => { window.selectedAddEmpId = null; window.selectedAddEmpName = null; window.selectedAddEmpBg = null; window.selectedAddStart = null; window.selectedAddEnd = null; setIsAddModalOpen(false); setTimeout(() => setIsAddModalOpen(true), 10); }} className="flex-1 bg-slate-700 py-3 rounded-xl font-black uppercase text-xs text-white shadow-lg transition-all hover:bg-slate-600 font-bold tracking-widest">Back</button>
                                        </div>
                                    </form>
                                )}
                                <button onClick={() => { setIsAddModalOpen(false); window.selectedAddEmpId = null; window.selectedAddEmpName = null; window.selectedAddEmpBg = null; window.selectedAddTime = null; }} className="w-full text-slate-600 text-[10px] font-black uppercase tracking-[0.2em] pt-6 text-center hover:text-white transition-colors underline font-bold tracking-widest">Cancel deployment</button>
                            </div>
                        </div>
                    )}

                    {/* EDIT MODAL */}
                    {editingShift && (
                        <div className="fixed inset-0 bg-black/90 backdrop-blur-md z-[500] flex items-center justify-center p-4">
                            <div className="glass-panel neon-fuchsia p-8 w-full max-w-sm shadow-2xl rounded-3xl text-left font-bold text-white">
                                <h3 className="text-xl font-black uppercase mb-8 text-center text-white tracking-tighter font-bold font-mono tracking-widest">Adjust Link</h3>
                                <form onSubmit={e => {
                                    e.preventDefault();
                                    const updatedEvents = { ...events };
                                    const dateShifts = updatedEvents[editingShift.date] || [];
                                    const shiftIndex = dateShifts.findIndex(s => s.id === editingShift.id);
                                    if (shiftIndex !== -1) {
                                        dateShifts[shiftIndex] = {
                                            ...dateShifts[shiftIndex],
                                            time: window.editingShiftTime || editingShift.time,
                                            note: window.editingShiftNote !== undefined ? window.editingShiftNote : (editingShift.note || ''),
                                            confirmed: editingShift.confirmed
                                        };
                                        updatedEvents[editingShift.date] = dateShifts;
                                        setEvents(updatedEvents);
                                        setEditingShift({ ...editingShift, time: window.editingShiftTime || editingShift.time, note: window.editingShiftNote !== undefined ? window.editingShiftNote : (editingShift.note || '') });
                                        saveToStorage(STORAGE_KEYS.SHIFTS, updatedEvents);
                                    }
                                    window.editingShiftTime = null;
                                    window.editingShiftNote = null;
                                    setEditingShift(null);
                                }} className="space-y-6 text-center font-bold">
                                    <button type="button" onClick={() => { 
                                        const updatedEvents = { ...events };
                                        const dateShifts = updatedEvents[editingShift.date] || [];
                                        const shiftIndex = dateShifts.findIndex(s => s.id === editingShift.id);
                                        if (shiftIndex !== -1) {
                                            dateShifts[shiftIndex] = { ...dateShifts[shiftIndex], confirmed: !editingShift.confirmed };
                                            updatedEvents[editingShift.date] = dateShifts;
                                            setEvents(updatedEvents);
                                            setEditingShift({ ...editingShift, confirmed: !editingShift.confirmed });
                                            saveToStorage(STORAGE_KEYS.SHIFTS, updatedEvents);
                                        }
                                    }} className={`w-full py-4 rounded-xl font-black text-xs uppercase transition-all ${editingShift.confirmed ? 'bg-cyan-600 text-white shadow-[0_0_15px_rgba(6,182,212,0.4)]' : 'bg-rose-600 text-white shadow-[0_0_15px_rgba(225,29,72,0.4)]'}`}>{editingShift.confirmed ? 'Link: Verified' : 'Link: Lost'}</button>
                                    <div className="text-left">
                                        <label className="block text-xs text-fuchsia-400 font-bold mb-1">Shift Time</label>
                                        <input type="time" defaultValue={editingShift.time} onChange={e => { window.editingShiftTime = e.target.value; }} className="w-full bg-black border border-fuchsia-500/40 rounded-xl p-3 text-center text-lg text-white outline-none shadow-inner font-black mb-4" required />
                                        <label className="block text-xs text-fuchsia-400 font-bold mb-1">Shift Note</label>
                                        <textarea defaultValue={editingShift.note || ''} onChange={e => { window.editingShiftNote = e.target.value; }} className="w-full bg-black border border-fuchsia-500/40 rounded-xl p-3 text-left text-base text-white outline-none shadow-inner font-bold min-h-[60px]" placeholder="Optional note..." />
                                    </div>
                                    <div className="flex gap-3 font-bold">
                                        <button type="submit" className="flex-1 bg-white text-black py-4 rounded-xl font-black uppercase text-xs hover:bg-cyan-400 transition-colors shadow-lg font-bold tracking-widest">Commit</button>
                                        <button type="button" onClick={() => { 
                                            if (!confirm("Terminate link?")) return;
                                            const updatedEvents = { ...events };
                                            const dateShifts = updatedEvents[editingShift.date] || [];
                                            updatedEvents[editingShift.date] = dateShifts.filter(s => s.id !== editingShift.id);
                                            if (updatedEvents[editingShift.date].length === 0) delete updatedEvents[editingShift.date];
                                            setEvents(updatedEvents);
                                            saveToStorage(STORAGE_KEYS.SHIFTS, updatedEvents);
                                            setEditingShift(null);
                                        }} className="bg-rose-600 px-8 py-4 rounded-xl text-white hover:bg-rose-500 shadow-lg font-bold">Remove</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Toast Notifications */}
                    <div className="fixed top-4 right-4 z-[2000] flex flex-col gap-3 items-end pointer-events-none">
                        {toasts.map(toast => (
                            <div 
                                key={toast.id} 
                                className="pointer-events-auto bg-gradient-to-r from-cyan-600 to-cyan-700 text-white px-6 py-3 rounded-xl shadow-2xl font-bold text-sm flex items-center gap-3 border border-cyan-400/30"
                                style={{animation: 'slideIn 0.3s ease-out'}}
                            >
                                <span className="flex-1">{toast.msg}</span>
                                <button 
                                    onClick={() => dismissToast(toast.id)}
                                    className="text-white/70 hover:text-white text-lg font-black"
                                >
                                    √ó
                                </button>
                                <div className="absolute bottom-0 left-0 h-1 bg-cyan-300" style={{animation: 'shrink 4s linear', width: '100%'}}></div>
                            </div>
                        ))}
                    </div>

                    {/* Panic Alert Modal */}
                    {showPanicAlert && (
                        <div className="fixed inset-0 bg-red-900/90 flex items-center justify-center p-4 z-[2000] animate-pulse">
                            <div className="bg-gray-900 rounded-lg shadow-2xl max-w-md w-full border-4 border-red-500" onClick={(e) => e.stopPropagation()}>
                                <div className="p-6 border-b border-red-500 bg-red-600">
                                    <h2 className="text-3xl font-black text-white flex items-center gap-3">
                                        üö® EMERGENCY ALERT ACTIVE
                                    </h2>
                                </div>
                                <div className="p-6 space-y-4">
                                    <div className="bg-red-900/50 p-4 rounded-lg border border-red-500">
                                        <div className="text-white font-bold text-lg mb-2">Alert Sent:</div>
                                        <div className="text-red-200 text-sm space-y-1">
                                            <div>üìç Location: Reception Desk</div>
                                            <div>üïê Time: {new Date().toLocaleTimeString()}</div>
                                        </div>
                                    </div>
                                    <div className="bg-yellow-900/50 p-4 rounded-lg border border-yellow-500">
                                        <div className="text-yellow-200 font-bold mb-2">üìû Emergency Contacts:</div>
                                        <div className="text-white text-sm space-y-1">
                                            <div>Security: <span className="font-black">Ext 2222</span></div>
                                            <div>Charge Nurse: <span className="font-black">Ext 3333</span></div>
                                            <div>Admin on Duty: <span className="font-black">Ext 4444</span></div>
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => setShowPanicAlert(false)}
                                        className="w-full bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-lg text-lg"
                                    >
                                        Close Alert
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* De-escalation Scripts Modal */}
                    {showDeescalation && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-[1300]" onClick={() => setShowDeescalation(false)}>
                            <div className="bg-gray-900 rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                                <div className="p-6 border-b border-purple-500/30 sticky top-0 bg-gray-900">
                                    <h2 className="text-2xl font-black text-purple-400">üí¨ Crisis De-escalation Guide</h2>
                                    <button 
                                        onClick={() => setShowDeescalation(false)}
                                        className="absolute top-4 right-4 text-white hover:text-purple-400 text-2xl"
                                    >√ó</button>
                                </div>
                                <div className="p-6 space-y-4">
                                    <div className="bg-purple-900/20 p-4 rounded-lg border border-purple-500/30">
                                        <h3 className="text-lg font-bold text-purple-400 mb-3">üéØ Core Principles</h3>
                                        <ul className="text-white text-sm space-y-2 list-disc list-inside">
                                            <li>Stay calm - your tone sets the tone</li>
                                            <li>Maintain safe distance (arm's length minimum)</li>
                                            <li>Use open body language, avoid crossed arms</li>
                                            <li>Listen actively, validate feelings</li>
                                            <li>Never argue or take things personally</li>
                                        </ul>
                                    </div>
                                    <div className="bg-green-900/20 p-4 rounded-lg border border-green-500/30">
                                        <h3 className="text-lg font-bold text-green-400 mb-3">‚úÖ Calming Phrases</h3>
                                        <div className="space-y-2 text-sm">
                                            <div className="bg-black/30 p-3 rounded text-green-200">"I can see this is really frustrating for you. Let's work through this together."</div>
                                            <div className="bg-black/30 p-3 rounded text-green-200">"You're right to feel upset. Help me understand what happened."</div>
                                            <div className="bg-black/30 p-3 rounded text-green-200">"I want to help you. Can you tell me more about what you need?"</div>
                                        </div>
                                    </div>
                                    <div className="bg-yellow-900/20 p-4 rounded-lg border border-yellow-500/30">
                                        <h3 className="text-lg font-bold text-yellow-400 mb-3">‚ö†Ô∏è When to Call for Backup</h3>
                                        <ul className="text-yellow-200 text-sm space-y-2 list-disc list-inside">
                                            <li>Aggressive body language or threats</li>
                                            <li>Any physical contact</li>
                                            <li>Your gut says it's unsafe</li>
                                        </ul>
                                        <div className="mt-3 bg-yellow-700 p-2 rounded text-black font-bold text-center">üÜò Security: Ext 2222</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Kudos Wall Modal */}
                    {showKudos && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-[1300]" onClick={() => setShowKudos(false)}>
                            <div className="bg-gray-900 rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                                <div className="p-6 border-b border-pink-500/30 sticky top-0 bg-gray-900">
                                    <h2 className="text-2xl font-black text-pink-400">üíñ Team Kudos Wall</h2>
                                    <button onClick={() => setShowKudos(false)} className="absolute top-4 right-4 text-white hover:text-pink-400 text-2xl">√ó</button>
                                </div>
                                <div className="p-6">
                                    <form onSubmit={(e) => {
                                        e.preventDefault();
                                        const formData = new FormData(e.target);
                                        const kudo = {
                                            id: Date.now(),
                                            from: 'Team Member',
                                            to: formData.get('to'),
                                            message: formData.get('message'),
                                            timestamp: new Date().toISOString()
                                        };
                                        const updated = [kudo, ...kudosWall];
                                        setKudosWall(updated);
                                        saveToStorage('kudos_wall', updated);
                                        showNotification('üíñ Kudos sent!');
                                        e.target.reset();
                                    }} className="mb-6 space-y-3 bg-pink-900/20 p-4 rounded-lg border border-pink-500/30">
                                        <input name="to" placeholder="Who are you appreciating?" className="w-full bg-black/50 border border-pink-500/30 rounded-lg p-3 text-white" required />
                                        <textarea name="message" placeholder="What do you want to say?" className="w-full bg-black/50 border border-pink-500/30 rounded-lg p-3 text-white h-20 resize-none" required />
                                        <button type="submit" className="w-full bg-pink-600 hover:bg-pink-500 text-white font-bold py-2 rounded-lg">Send Kudos üíñ</button>
                                    </form>
                                    <div className="space-y-3">
                                        {kudosWall.length === 0 ? (
                                            <div className="text-center text-white/50 py-8">No kudos yet. Be the first!</div>
                                        ) : (
                                            kudosWall.map(kudo => (
                                                <div key={kudo.id} className="bg-gradient-to-r from-pink-900/30 to-purple-900/30 p-4 rounded-lg border border-pink-500/30">
                                                    <div className="flex items-start justify-between mb-2">
                                                        <div className="font-bold text-pink-300">To: {kudo.to}</div>
                                                        <div className="text-xs text-white/50">{new Date(kudo.timestamp).toLocaleDateString()}</div>
                                                    </div>
                                                    <div className="text-white mb-2">{kudo.message}</div>
                                                    <div className="text-xs text-pink-400">- {kudo.from}</div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Team Achievements Modal */}
                    {showAchievements && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-[1300]" onClick={() => setShowAchievements(false)}>
                            <div className="bg-gray-900 rounded-lg shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}>
                                <div className="p-6 border-b border-yellow-500/30 sticky top-0 bg-gray-900">
                                    <h2 className="text-2xl font-black text-yellow-400">üèÜ Team Achievements</h2>
                                    <button onClick={() => setShowAchievements(false)} className="absolute top-4 right-4 text-white hover:text-yellow-400 text-2xl">√ó</button>
                                </div>
                                <div className="p-6">
                                    <div className="mb-6 bg-gradient-to-r from-cyan-900/30 to-blue-900/30 p-4 rounded-lg border border-cyan-500/30">
                                        <div className="text-center">
                                            <div className="text-4xl mb-2">{motivationalQuote.text}</div>
                                            <div className="text-cyan-400 text-sm">- {motivationalQuote.author}</div>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="bg-yellow-900/20 p-4 rounded-lg border-2 border-yellow-500 text-center">
                                            <div className="text-4xl mb-2">üåü</div>
                                            <div className="text-yellow-400 font-bold">Early Bird</div>
                                            <div className="text-xs text-white/70">Always on time</div>
                                        </div>
                                        <div className="bg-blue-900/20 p-4 rounded-lg border-2 border-blue-500 text-center">
                                            <div className="text-4xl mb-2">ü¶∏</div>
                                            <div className="text-blue-400 font-bold">Crisis Hero</div>
                                            <div className="text-xs text-white/70">Calm under pressure</div>
                                        </div>
                                        <div className="bg-green-900/20 p-4 rounded-lg border-2 border-green-500 text-center">
                                            <div className="text-4xl mb-2">ü§ù</div>
                                            <div className="text-green-400 font-bold">Team Player</div>
                                            <div className="text-xs text-white/70">Always helps others</div>
                                        </div>
                                        <div className="bg-purple-900/20 p-4 rounded-lg border-2 border-purple-500 text-center">
                                            <div className="text-4xl mb-2">üìù</div>
                                            <div className="text-purple-400 font-bold">Detail Master</div>
                                            <div className="text-xs text-white/70">Perfect shift reports</div>
                                        </div>
                                        <div className="bg-pink-900/20 p-4 rounded-lg border-2 border-pink-500 text-center">
                                            <div className="text-4xl mb-2">üí™</div>
                                            <div className="text-pink-400 font-bold">Iron Person</div>
                                            <div className="text-xs text-white/70">30 days streak</div>
                                        </div>
                                        <div className="bg-red-900/20 p-4 rounded-lg border-2 border-red-500 text-center">
                                            <div className="text-4xl mb-2">üî•</div>
                                            <div className="text-red-400 font-bold">Hot Streak</div>
                                            <div className="text-xs text-white/70">Most shifts this month</div>
                                        </div>
                                    </div>
                                    <div className="mt-6 bg-white/5 p-4 rounded-lg text-center">
                                        <div className="text-cyan-400 font-bold mb-2">üéâ Team Stats</div>
                                        <div className="text-white text-sm space-y-1">
                                            <div>Total Shifts: <span className="font-black text-cyan-400">{Object.values(events).flat().length}</span></div>
                                            <div>Team Members: <span className="font-black text-cyan-400">{Object.keys(staff).length}</span></div>
                                            <div>Kudos Shared: <span className="font-black text-pink-400">{kudosWall.length}</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>