<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destiny Springs | Hub Matrix</title>
    <!-- System Engines -->
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        :root {
            --color-bg-dark: #0a0a23;
            --color-bg-light: #f4f7fa;
            --color-primary: #00fff7;
            --color-accent: #ff00ea;
            --color-surface: #18182f;
            --color-surface-light: #fff;
            --color-text-dark: #fff;
            --color-text-light: #18182f;
            --color-shadow: 0 4px 32px 0 rgba(0,255,247,0.08);
        }
        body[data-theme="dark"] {
            background: var(--color-bg-dark);
            color: var(--color-text-dark);
        }
        body[data-theme="light"] {
            background: var(--color-bg-light);
            color: var(--color-text-light);
        }
        .glass-panel {
            background: rgba(0,255,247,0.03);
            border: 1.5px solid rgba(0,255,247,0.12);
            border-radius: 18px;
            box-shadow: var(--color-shadow);
        }
        body[data-theme="light"] .glass-panel {
            background: #fff;
            color: var(--color-text-light);
            border: 1.5px solid #e0e7ef;
            box-shadow: 0 4px 32px 0 rgba(0,0,0,0.04);
        }
        body[data-theme="light"] .neon-blue {
            border: 1.5px solid #0ea5e9;
            box-shadow: 0 0 24px 0 #bae6fd, 0 4px 32px 0 rgba(0,0,0,0.04);
        }
        body[data-theme="light"] .neon-fuchsia {
            border: 1.5px solid #e879f9;
            box-shadow: 0 0 24px 0 #f0abfc, 0 4px 32px 0 rgba(0,0,0,0.04);
        }
        body[data-theme="light"] .holo-text {
            text-shadow: 0 0 16px #bae6fd, 0 0 2px #f0abfc;
        }
        body[data-theme="light"] .nav-rail-btn {
            background: #f1f5f9 !important;
            border: 2px solid #0ea5e9 !important;
            color: #0ea5e9 !important;
            box-shadow: 0 0 8px 0 #bae6fd, 0 2px 8px 0 #000 !important;
        }
        body[data-theme="light"] .nav-rail-btn svg {
            color: #0ea5e9 !important;
            filter: drop-shadow(0 0 4px #bae6fd);
        }
        body[data-theme="light"] .nav-rail-btn:hover {
            background: #f0abfc !important;
            border-color: #e879f9 !important;
            color: #e879f9 !important;
            box-shadow: 0 0 16px 0 #f0abfc, 0 2px 8px 0 #000 !important;
        }
        body[data-theme="light"] .nav-rail-btn:hover svg {
            color: #e879f9 !important;
            filter: drop-shadow(0 0 6px #f0abfc);
        }
        body[data-theme="light"] .fancy-btn {
            background: linear-gradient(90deg, #0ea5e9 0%, #e879f9 100%);
            color: #18182f;
            box-shadow: 0 2px 16px 0 #bae6fd;
        }
        body[data-theme="light"] .fancy-btn:hover {
            background: linear-gradient(90deg, #e879f9 0%, #0ea5e9 100%);
            color: #18182f;
            box-shadow: 0 4px 32px 0 #f0abfc;
        }
        body[data-theme="light"] .bg-black,
        body[data-theme="light"] .bg-[#050505],
        body[data-theme="light"] .bg-[#080808],
        body[data-theme="light"] .bg-rose-950\/20 {
            background: #f4f7fa !important;
        }
        body[data-theme="light"] .text-white {
            color: #18182f !important;
        }
        body[data-theme="light"] .text-cyan-400 {
            color: #0ea5e9 !important;
        }
        body[data-theme="light"] .text-fuchsia-400 {
            color: #e879f9 !important;
        }
        body[data-theme="light"] .text-rose-500 {
            color: #e11d48 !important;
        }
        body[data-theme="light"] .bg-cyan-600\/80 {
            background: #bae6fd !important;
            color: #18182f !important;
        }
        body[data-theme="light"] .bg-rose-600\/80 {
            background: #fca5a5 !important;
            color: #18182f !important;
        }
        body[data-theme="light"] .bg-fuchsia-600\/80 {
            background: #f0abfc !important;
            color: #18182f !important;
        }
        body[data-theme="light"] .bg-blue-600\/80 {
            background: #bae6fd !important;
            color: #18182f !important;
        }
        body[data-theme="light"] .bg-slate-700 {
            background: #e0e7ef !important;
            color: #18182f !important;
        }
        .nav-rail-btn {
            background: rgba(0,255,247,0.10) !important;
            border: 2px solid var(--color-primary) !important;
            color: #00fff7 !important;
            box-shadow: 0 0 8px 0 var(--color-primary), 0 2px 8px 0 #000 !important;
            opacity: 1 !important;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
        }
        .nav-rail-btn svg {
            color: #00fff7 !important;
            filter: drop-shadow(0 0 4px #00fff7);
        }
        .nav-rail-btn:hover {
            background: rgba(255,0,234,0.15) !important;
            border-color: var(--color-accent) !important;
            color: #ff00ea !important;
            box-shadow: 0 0 16px 0 var(--color-accent), 0 2px 8px 0 #000 !important;
        }
        .nav-rail-btn:hover svg {
            color: #ff00ea !important;
            filter: drop-shadow(0 0 6px #ff00ea);
        }
        .neon-blue {
            border: 1.5px solid var(--color-primary);
            box-shadow: 0 0 24px 0 var(--color-primary), var(--color-shadow);
        }
        .neon-fuchsia {
            border: 1.5px solid var(--color-accent);
            box-shadow: 0 0 24px 0 var(--color-accent), var(--color-shadow);
        }
        .holo-text {
            text-shadow: 0 0 16px var(--color-primary), 0 0 2px var(--color-accent);
        }
        .fancy-btn {
            background: linear-gradient(90deg, var(--color-primary) 0%, var(--color-accent) 100%);
            color: #fff;
            border: none;
            border-radius: 1em;
            font-weight: 900;
            letter-spacing: 0.1em;
            box-shadow: 0 2px 16px 0 var(--color-primary);
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
        }
        .fancy-btn:hover {
            background: linear-gradient(90deg, var(--color-accent) 0%, var(--color-primary) 100%);
            color: #fff;
            box-shadow: 0 4px 32px 0 var(--color-accent);
        }
        @media (max-width: 900px) {
            .flex, .flex-1, .flex-col, .flex-row, .p-8, .p-10, .w-80, .max-w-2xl, .max-w-md {
                padding: 0.5em !important;
                width: 100% !important;
                max-width: 100% !important;
            }
            .sidebar, .main-grid {
                flex-direction: column !important;
            }
            .calendar-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                font-size: 12px !important;
            }
            .nav-rail-btn, .fancy-btn, button {
                min-height: 48px !important;
                font-size: 16px !important;
                padding: 0.5em 1em !important;
            }
            .glass-panel, .neon-blue, .neon-fuchsia {
                padding: 0.5em !important;
                border-radius: 1em !important;
            }
            .no-print {
                font-size: 14px !important;
            }
            .sidebar, aside {
                min-width: 0 !important;
                width: 100% !important;
                padding: 0.5em !important;
            }
            .main-grid, main {
                padding: 0.5em !important;
            }
            .modal, .glass-panel {
                max-width: 98vw !important;
                max-height: 98vh !important;
                overflow-y: auto !important;
            }
        }
        @media (max-width: 600px) {
            .calendar-grid {
                grid-template-columns: repeat(1, 1fr) !important;
                font-size: 11px !important;
            }
            .nav-rail-btn, .fancy-btn, button {
                min-height: 44px !important;
                font-size: 15px !important;
            }
        }
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; color: black !important; }
            .glass-panel, .neon-blue, .neon-fuchsia {
                background: white !important;
                color: black !important;
                border: 1px solid #333 !important;
                box-shadow: none !important;
            }
            .calendar-grid .bg-cyan-600\/80, .calendar-grid .bg-rose-600\/80, .calendar-grid .bg-fuchsia-600\/80, .calendar-grid .bg-blue-600\/80, .calendar-grid .bg-slate-700 {
                color: white !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .calendar-grid .bg-cyan-600\/80 { background: #06b6d4 !important; }
            .calendar-grid .bg-rose-600\/80 { background: #e11d48 !important; }
            .calendar-grid .bg-fuchsia-600\/80 { background: #d946ef !important; }
            .calendar-grid .bg-blue-600\/80 { background: #2563eb !important; }
            .calendar-grid .bg-slate-700 { background: #334155 !important; }
            .calendar-grid .text-white { color: #fff !important; }
            .calendar-grid .text-cyan-400 { color: #0891b2 !important; }
            .calendar-grid .text-rose-500 { color: #e11d48 !important; }
            .calendar-grid .text-fuchsia-400 { color: #d946ef !important; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- ADMIN CONFIGURATION ---
        const ADMIN_CODE = 'admin123'; // Change this to your desired admin password

        // --- FIREBASE INIT ---
        const firebaseConfig = {
            apiKey: "AIzaSyCmNpRkPR160wYwwmToPDSNFac4iKQXVbo",
            authDomain: "rockstar-reception.firebaseapp.com",
            projectId: "rockstar-reception",
            storageBucket: "rockstar-reception.firebasestorage.app",
            messagingSenderId: "46215930012",
            appId: "1:46215930012:web:e285e0cfe79154c9f18d59",
            measurementId: "G-BFLB72NK0F"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // --- FIRESTORE DATA LAYER (SHARED) ---
        async function saveToFirestore(collection, doc, data) {
            await db.collection(collection).doc(doc).set(data);
        }
        async function loadFromFirestore(collection, doc, defaultValue = null) {
            const snap = await db.collection(collection).doc(doc).get();
            return snap.exists ? snap.data() : defaultValue;
        }

        // --- LOCALSTORAGE DATA LAYER ---
        const STORAGE_KEYS = {
            SHIFTS: 'reception_shifts',
            STAFF: 'reception_staff',
            MESSAGES: 'reception_messages',
            REPORTS: 'reception_reports',
            ALERT: 'reception_alert',
            INITIALIZED: 'reception_initialized'
        };

        // ...existing code...

        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.error('Failed to save to localStorage:', e);
            }
        }

        function loadFromStorage(key, defaultValue = null) {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (e) {
                console.error('Failed to load from localStorage:', e);
                return defaultValue;
            }
        }

        function clearAllStorage() {
            Object.values(STORAGE_KEYS).forEach(key => localStorage.removeItem(key));
        }

        // --- ICON SUITE ---
        const IconCalendar = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
        const IconSync = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></svg>;
        const IconPersonnel = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>;
        const IconPlus = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
        const IconAlert = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>;
        const IconChevronL = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"/></svg>;
        const IconChevronR = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>;
        const IconLock = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const IconTrash = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>;
        const IconActivity = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>;
        const IconTerminal = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>;

        const REPORT_FIELDS = [
            { id: 'mail', label: 'Mail / Deliveries' }, 
            { id: 'property', label: 'Patient Property' },
            { id: 'supplies', label: 'Hub Supplies' }, 
            { id: 'lobby', label: 'Lobby Status' },
            { id: 'aoc', label: 'AOC Status' }
        ];

        // --- DETERMINISTIC SEED DATA FOR FIRST LOAD ---
        function initializeSeedData() {
            // Seed staff
            const seedStaff = {
                'unit-karen': { id: 'unit-karen', name: 'Karen', bg: 'bg-cyan-600/80' },
                'unit-izzy': { id: 'unit-izzy', name: 'Izzy', bg: 'bg-rose-600/80' },
                'unit-annalissia': { id: 'unit-annalissia', name: 'Annalissia', bg: 'bg-fuchsia-600/80' },
                'unit-hal': { id: 'unit-hal', name: 'Hal', bg: 'bg-blue-600/80' }
            };
            saveToStorage(STORAGE_KEYS.STAFF, seedStaff);

            // Always seed for February of the current year
            const now = new Date();
            const year = now.getFullYear();
            const month = 1; // February (0-based)
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const shifts = {};
            for (let d = 1; d <= daysInMonth; d++) {
                const date = new Date(year, month, d);
                const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const dow = date.getDay();
                // Create sample shifts based on day of week
                if (dow === 1 || dow === 3) { // Mon, Wed
                    shifts[dateKey] = [{ id: `shift-${Date.now()}-${d}-1`, date: dateKey, empId: 'unit-karen', time: '08:00', confirmed: true }];
                } else if (dow === 2 || dow === 4 || dow === 5) { // Tue, Thu, Fri
                    shifts[dateKey] = [{ id: `shift-${Date.now()}-${d}-2`, date: dateKey, empId: 'unit-izzy', time: '08:00', confirmed: true }];
                } else if (dow === 0) { // Sunday
                    shifts[dateKey] = [
                        { id: `shift-${Date.now()}-${d}-3`, date: dateKey, empId: 'unit-hal', time: '16:00', confirmed: true },
                        { id: `shift-${Date.now()}-${d}-4`, date: dateKey, empId: 'unit-annalissia', time: '08:00', confirmed: true }
                    ];
                }
            }
            saveToStorage(STORAGE_KEYS.SHIFTS, shifts);

            // Seed messages
            const seedMessages = [
                { id: 'msg-1', text: 'Welcome to Reception! Your calendar is ready.', user: 'SYSTEM', createdAt: Date.now() - 7200000 },
                { id: 'msg-2', text: 'All data is stored locally in your browser.', user: 'SYSTEM', createdAt: Date.now() - 3600000 },
                { id: 'msg-3', text: 'Use the Export Matrix button to print or save your schedule.', user: 'INFO', createdAt: Date.now() }
            ];
            saveToStorage(STORAGE_KEYS.MESSAGES, seedMessages);

            // Seed report data for today
            const today = now.toISOString().split('T')[0];
            const seedReports = {
                [today]: {
                    mail: 'Sample: Mail delivery expected at 2 PM',
                    property: 'Sample: All patient property secured',
                    supplies: 'Sample: Stock levels normal',
                    lobby: 'Sample: Clean and organized',
                    aoc: 'Sample: All systems operational'
                }
            };
            saveToStorage(STORAGE_KEYS.REPORTS, seedReports);

            // Seed alert
            saveToStorage(STORAGE_KEYS.ALERT, 'Welcome to Reception - Your offline staff calendar');

            // Mark as initialized
            saveToStorage(STORAGE_KEYS.INITIALIZED, true);
        }

                // --- THEME INIT ---
                function getInitialTheme() {
                    const stored = localStorage.getItem('reception_theme');
                    if (stored === 'light' || stored === 'dark') return stored;
                    return 'dark';
                }

                function App() {
                    const [theme, setTheme] = useState(getInitialTheme());
                    const [showPrefs, setShowPrefs] = useState(false);
                    const [notifyEnabled, setNotifyEnabled] = useState(false);
                    useEffect(() => {
                        document.body.setAttribute('data-theme', theme);
                    }, [theme]);

                    // Load user preferences from Firestore
                    useEffect(() => {
                        if (!user) return;
                        db.collection('userprefs').doc(user.uid).get().then(doc => {
                            if (doc.exists) {
                                const prefs = doc.data();
                                if (prefs.theme) setTheme(prefs.theme);
                                if (prefs.notifyEnabled !== undefined) setNotifyEnabled(prefs.notifyEnabled);
                            }
                        });
                    }, [user]);

                    // Save preferences to Firestore
                    function savePrefs(newTheme, newNotify) {
                        if (!user) return;
                        db.collection('userprefs').doc(user.uid).set({
                            theme: newTheme,
                            notifyEnabled: newNotify
                        }, { merge: true });
                    }

                    // --- AUTH STATE ---
                    const [user, setUser] = useState(null);
                    const [authMode, setAuthMode] = useState('login'); // 'login' | 'register'
                    const [authEmail, setAuthEmail] = useState('');
                    const [authPassword, setAuthPassword] = useState('');
                    const [authError, setAuthError] = useState('');
                    useEffect(() => {
                        const unsub = auth.onAuthStateChanged(u => setUser(u));
                        return () => unsub();
                    }, []);

                    async function handleAuth(e) {
                        e.preventDefault();
                        setAuthError('');
                        try {
                            if (authMode === 'login') {
                                await auth.signInWithEmailAndPassword(authEmail, authPassword);
                            } else {
                                await auth.createUserWithEmailAndPassword(authEmail, authPassword);
                            }
                        } catch (err) {
                            setAuthError(err.message);
                        }
                    }
                    async function handleGoogle() {
                        setAuthError('');
                        const provider = new firebase.auth.GoogleAuthProvider();
                        try {
                            await auth.signInWithPopup(provider);
                        } catch (err) {
                            setAuthError(err.message);
                        }
                    }
                    function handleLogout() {
                        auth.signOut();
                    }
                    // --- FIRESTORE SYNC HOOKS ---
                        // Load shared shifts and staff from Firestore on mount
                        useEffect(() => {
                            async function fetchSharedData() {
                                const loadedShifts = await loadFromFirestore('shared', 'shifts', {});
                                const loadedStaff = await loadFromFirestore('shared', 'staff', {});
                                setEvents(loadedShifts);
                                setStaff(loadedStaff);
                                // Load all reports for all dates
                                const loadedReports = await loadFromFirestore('shared', 'reports', {});
                                setAllReports(loadedReports);
                            }
                            fetchSharedData();
                        }, []);

                        // Save shifts to Firestore when events change
                        useEffect(() => {
                            if (Object.keys(events).length > 0) {
                                saveToFirestore('shared', 'shifts', events);
                            }
                        }, [events]);

                        // Save staff to Firestore when staff changes
                        useEffect(() => {
                            if (Object.keys(staff).length > 0) {
                                saveToFirestore('shared', 'staff', staff);
                            }
                        }, [staff]);
            // --- Application State ---
            // Always default to the current month on load
            const [currentDate, setCurrentDate] = useState(() => {
                const now = new Date();
                return new Date(now.getFullYear(), now.getMonth(), 1);
            });
            const [selectedDate, setSelectedDate] = useState(() => new Date().toISOString().split('T')[0]);
            const [events, setEvents] = useState({});
            const [staff, setStaff] = useState({});
            const [messages, setMessages] = useState([]);
            const [reportData, setReportData] = useState({});
            // Daily checklist state
            const [checklist, setChecklist] = useState(() => loadFromStorage('reception_checklist_' + selectedDate, []));
            const [newChecklistItem, setNewChecklistItem] = useState('');
            const [globalAlert, setGlobalAlert] = useState('');
            const [isPersonnelModalOpen, setIsPersonnelModalOpen] = useState(false);
            const [isAddModalOpen, setIsAddModalOpen] = useState(false);
            const [editingShift, setEditingShift] = useState(null);
            const [adminCode, setAdminCode] = useState('');
            const [isAdminAuth, setIsAdminAuth] = useState(false);
            const [chatInput, setChatInput] = useState('');
            const [newStaffName, setNewStaffName] = useState('');
            const [newStaffColor, setNewStaffColor] = useState('#0891b2');
            const chatEndRef = useRef(null);

            // --- Initialize Data from localStorage ---
            useEffect(() => {
                // Check if app has been initialized before
                const initialized = loadFromStorage(STORAGE_KEYS.INITIALIZED);
                
                if (!initialized) {
                    // First load - initialize with seed data
                    initializeSeedData();
                }

                // Load data from localStorage
                loadDataFromStorage();
            }, []);

            function loadDataFromStorage() {
                const loadedShifts = loadFromStorage(STORAGE_KEYS.SHIFTS, {});
                const loadedStaff = loadFromStorage(STORAGE_KEYS.STAFF, {});
                const loadedMessages = loadFromStorage(STORAGE_KEYS.MESSAGES, []);
                const loadedAlert = loadFromStorage(STORAGE_KEYS.ALERT, '');
                
                setEvents(loadedShifts);
                setStaff(loadedStaff);
                setMessages(loadedMessages);
                setGlobalAlert(loadedAlert);
            }

            // --- Load report data and checklist when selected date changes ---
            useEffect(() => {
                const allReports = loadFromStorage(STORAGE_KEYS.REPORTS, {});
                setReportData(allReports[selectedDate] || {});
                setChecklist(loadFromStorage('reception_checklist_' + selectedDate, []));
            }, [selectedDate]);

            // --- Admin Master Reset Pattern ---
            // --- Baseline Save/Restore ---
            function saveBaseline() {
                // Save current staff and shifts as baseline for the current month
                const mIdx = currentDate.getMonth(), yIdx = currentDate.getFullYear();
                const key = `baseline_${yIdx}_${String(mIdx+1).padStart(2,'0')}`;
                const baseline = {
                    staff,
                    shifts: events
                };
                saveToStorage(key, baseline);
                alert('Baseline for this month saved!');
            }

            function restoreBaseline() {
                const mIdx = currentDate.getMonth(), yIdx = currentDate.getFullYear();
                const key = `baseline_${yIdx}_${String(mIdx+1).padStart(2,'0')}`;
                const baseline = loadFromStorage(key);
                if (!baseline) {
                    alert('No baseline saved for this month.');
                    return;
                }
                setStaff(baseline.staff);
                setEvents(baseline.shifts);
                saveToStorage(STORAGE_KEYS.STAFF, baseline.staff);
                saveToStorage(STORAGE_KEYS.SHIFTS, baseline.shifts);
                alert('Baseline restored for this month!');
            }

            function handleMasterReset() {
                const year = new Date().getFullYear();
                if (!confirm(`ADMIN MASTER RESET: Restore personnel Karen, Izzy, Annalissia, and Hal and force February ${year} Baseline schedule?`)) return;
                // Clear all data and re-initialize
                clearAllStorage();
                initializeSeedData();
                loadDataFromStorage();
                alert('Master reset complete!');
            }

            // --- UI Elements ---
            const [shiftStatusFilter, setShiftStatusFilter] = useState('all');
            const [shiftSearch, setShiftSearch] = useState('');
            const calendarMatrix = useMemo(() => {
                const mIdx = currentDate.getMonth(), yIdx = currentDate.getFullYear();
                const total = new Date(yIdx, mIdx + 1, 0).getDate();
                const start = new Date(yIdx, mIdx, 1).getDay();
                const cells = [];
                // CALENDAR TALLER: min-h bumped to 180px
                for (let i = 0; i < start; i++) cells.push(<div key={`e-${i}`} className="min-h-[180px] bg-white/[0.01] border border-white/[0.03]" />);
                for (let d = 1; d <= total; d++) {
                    const dk = `${yIdx}-${String(mIdx + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                    let dayShifts = events[dk] || [];
                    if (shiftStatusFilter === 'confirmed') dayShifts = dayShifts.filter(s => s.confirmed);
                    if (shiftStatusFilter === 'pending') dayShifts = dayShifts.filter(s => !s.confirmed);
                    if (shiftSearch.trim()) {
                        const search = shiftSearch.trim().toLowerCase();
                        dayShifts = dayShifts.filter(s => {
                            const emp = staff[s.empId]?.name?.toLowerCase() || '';
                            return emp.includes(search) || dk.includes(search);
                        });
                    }
                    const isToday = new Date().toISOString().split('T')[0] === dk;
                    cells.push(
                        <div key={dk} onClick={() => setSelectedDate(dk)} className={`min-h-[180px] p-3 border border-white/[0.05] transition-all cursor-pointer relative group ${selectedDate === dk ? 'bg-cyan-500/10 ring-1 ring-cyan-400 shadow-inner' : 'bg-white/[0.01] hover:bg-white/[0.03]'} ${isToday ? 'border-l-2 border-l-cyan-400' : ''}`}>
                            <div className="flex justify-between items-start">
                                <span className={`text-xl font-black tracking-tighter ${selectedDate === dk ? 'text-cyan-400' : 'text-slate-600'}`}>{d}</span>
                                <button onClick={(e) => { e.stopPropagation(); setSelectedDate(dk); setIsAddModalOpen(true); }} className="p-1 opacity-20 hover:opacity-100 transition-opacity"><IconPlus /></button>
                            </div>
                            <div className="space-y-2 mt-4">
                                {dayShifts.length === 0 ? <div className="text-[10px] font-black text-rose-500 animate-pulse uppercase flex items-center gap-1 mt-2 text-left font-mono italic"><IconAlert /> Needs Coverage</div> : 
                                    dayShifts.map(s => (
                                        <div key={s.id} onClick={(e) => { e.stopPropagation(); setEditingShift(s); }} 
                                            className={`text-[13px] p-2 rounded-xl font-bold truncate text-white ${staff[s.empId]?.bg || 'bg-slate-700'} uppercase flex flex-col justify-between text-left shadow-2xl border border-white/10 group-hover:scale-105 transition-transform cursor-pointer`}>
                                            <div className="flex items-center justify-between">
                                                <span>{staff[s.empId]?.name || '...'}</span>
                                                <span className="opacity-50 text-[10px] font-mono shrink-0">{s.start && s.end ? `${s.start} - ${s.end}` : (s.start || s.time || '')}</span>
                                            </div>
                                        </div>
                                    ))
                                }
                            </div>
                        </div>
                    );
                }
                return cells;
            }, [currentDate, events, selectedDate, staff, shiftStatusFilter, shiftSearch]);

            if (!user) {
                return (
                    <div className="flex h-screen w-screen items-center justify-center bg-black text-xs">
                        <div className="glass-panel neon-blue p-10 w-full max-w-xs flex flex-col gap-6 items-center">
                            <h2 className="text-2xl font-black text-cyan-400 uppercase tracking-tighter">Reception Login</h2>
                            <form onSubmit={handleAuth} className="flex flex-col gap-3 w-full">
                                <input type="email" value={authEmail} onChange={e => setAuthEmail(e.target.value)} placeholder="Email" className="bg-black border border-cyan-500/30 rounded-xl p-3 text-white font-bold" required />
                                <input type="password" value={authPassword} onChange={e => setAuthPassword(e.target.value)} placeholder="Password" className="bg-black border border-cyan-500/30 rounded-xl p-3 text-white font-bold" required />
                                {authError && <div className="text-rose-500 text-xs font-bold">{authError}</div>}
                                <button type="submit" className="fancy-btn py-3 mt-2 font-black uppercase">{authMode === 'login' ? 'Login' : 'Register'}</button>
                            </form>
                            <button onClick={handleGoogle} className="bg-white text-black rounded-xl px-4 py-2 font-black shadow hover:bg-cyan-100 transition-all">Sign in with Google</button>
                            <div className="text-xs text-slate-400 mt-2">
                                {authMode === 'login' ? (
                                    <>No account? <button className="underline text-cyan-400" onClick={() => setAuthMode('register')}>Register</button></>
                                ) : (
                                    <>Already have an account? <button className="underline text-cyan-400" onClick={() => setAuthMode('login')}>Login</button></>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }
            return (
                <div className="flex h-screen w-screen bg-black overflow-hidden text-xs">
                    {/* NAV RAIL */}
                    <nav className="no-print w-16 bg-[#050505] border-r border-white/5 flex flex-col items-center py-8 gap-10">
                        <div className="text-cyan-400 font-black text-xl holo-text">DS</div>
                        <button onClick={handleMasterReset} className="nav-rail-btn p-3 rounded-xl transition-all hover:scale-110" title="Admin Master Reset"><IconSync /></button>
                        <button onClick={saveBaseline} className="nav-rail-btn p-3 rounded-xl transition-all hover:scale-110" title="Save Baseline for Month">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                        </button>
                        <button onClick={restoreBaseline} className="nav-rail-btn p-3 rounded-xl transition-all hover:scale-110" title="Restore Baseline for Month">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>
                        </button>
                        <button onClick={() => setIsPersonnelModalOpen(true)} className="nav-rail-btn p-3 rounded-xl transition-all hover:scale-110" title="Personnel Manifest"><IconPersonnel /></button>
                        <div className="mt-auto flex flex-col items-center gap-3">
                            <div className="w-2.5 h-2.5 rounded-full status-pulse bg-emerald-500 shadow-[0_0_10px_#10b981]" title="Local Storage Ready" />
                            <div className="opacity-10 text-[8px] font-black uppercase rotate-90 tracking-widest font-mono">Protocol</div>
                        </div>
                    </nav>

                    <div className="flex-1 flex flex-col">
                        <div className="no-print flex items-center justify-end gap-4 px-6 py-2 bg-transparent">
                            <span className="text-cyan-400 font-bold text-xs">{user.email}</span>
                            <button onClick={() => setShowPrefs(true)} className="bg-cyan-700 text-white rounded px-3 py-1 font-bold text-xs hover:bg-cyan-400 transition-all">Preferences</button>
                            <button onClick={handleLogout} className="bg-rose-500 text-white rounded px-3 py-1 font-bold text-xs hover:bg-rose-400 transition-all">Logout</button>
                        </div>

                        {/* Preferences Modal */}
                        {showPrefs && (
                            <div className="fixed inset-0 bg-black/80 z-[1000] flex items-center justify-center">
                                <div className="glass-panel neon-blue p-8 w-full max-w-xs flex flex-col gap-6">
                                    <h2 className="text-xl font-black text-cyan-400 uppercase tracking-tighter mb-2">Preferences</h2>
                                    <div className="flex flex-col gap-3">
                                        <label className="font-bold text-xs text-cyan-400">Theme</label>
                                        <select value={theme} onChange={e => { setTheme(e.target.value); savePrefs(e.target.value, notifyEnabled); }} className="bg-black border border-cyan-500/30 rounded-xl p-2 text-white font-bold">
                                            <option value="dark">Dark</option>
                                            <option value="light">Light</option>
                                        </select>
                                        <label className="font-bold text-xs text-cyan-400 mt-4">Notifications</label>
                                        <div className="flex items-center gap-2">
                                            <input type="checkbox" checked={notifyEnabled} onChange={e => { setNotifyEnabled(e.target.checked); savePrefs(theme, e.target.checked); }} />
                                            <span className="text-xs">Enable notifications</span>
                                        </div>
                                    </div>
                                    <button onClick={() => setShowPrefs(false)} className="bg-cyan-700 text-white rounded px-3 py-1 font-bold text-xs hover:bg-cyan-400 transition-all mt-4">Close</button>
                                </div>
                            </div>
                        )}
                        <header className="no-print h-10 bg-rose-950/20 border-b border-rose-500/30 flex items-center px-6 gap-4 text-left font-bold">
                            <div className="flex items-center gap-2 text-rose-500 font-black text-[9px] uppercase tracking-widest alert-pulse shrink-0"><IconAlert /> Critical Intel</div>
                            <input value={globalAlert} onChange={e => { 
                                const newAlert = String(e.target.value);
                                setGlobalAlert(newAlert);
                                saveToStorage(STORAGE_KEYS.ALERT, newAlert);
                            }} className="flex-1 bg-transparent border-none text-[11px] font-bold text-white outline-none placeholder-rose-900" placeholder="Broadcast immediate hub directive..." />
                            <button className="fancy-btn ml-4" onClick={() => {
                                const newTheme = theme === 'dark' ? 'light' : 'dark';
                                setTheme(newTheme);
                                localStorage.setItem('reception_theme', newTheme);
                            }}>
                                Toggle {theme === 'dark' ? 'Light' : 'Dark'} Mode
                            </button>
                        </header>

                        <div className="flex-1 flex overflow-hidden">
                            {/* SIDEBAR LOGS */}
                            <aside className="no-print w-80 bg-[#080808] border-r border-white/5 p-5 flex flex-col gap-4 overflow-y-auto no-scrollbar">
                                <header className="text-left mb-2 text-white font-black flex items-center justify-between">
                                    <div>
                                        <h1 className="text-lg tracking-tighter holo-text uppercase">Shift Report</h1>
                                        <div className="text-[10px] text-cyan-400 font-bold uppercase mt-1 tracking-widest font-mono">{selectedDate}</div>
                                    </div>
                                    <button
                                        className="ml-2 bg-cyan-600 hover:bg-cyan-400 text-white rounded px-3 py-1 text-xs font-bold shadow"
                                        title="Download PDF"
                                        onClick={() => {
                                            const { jsPDF } = window.jspdf;
                                            const doc = new jsPDF();
                                            doc.setFontSize(18);
                                            doc.text('Shift Report', 14, 18);
                                            doc.setFontSize(12);
                                            doc.text(`Date: ${selectedDate}`, 14, 28);
                                            let y = 38;
                                            REPORT_FIELDS.forEach(f => {
                                                doc.setFont(undefined, 'bold');
                                                doc.text(f.label + ':', 14, y);
                                                doc.setFont(undefined, 'normal');
                                                const val = (reportData && reportData[f.id]) ? String(reportData[f.id]) : '';
                                                doc.text(val, 30, y);
                                                y += 12;
                                            });
                                            doc.save(`shift_report_${selectedDate}.pdf`);
                                        }}
                                    >Download PDF</button>
                                </header>
                                <div className="space-y-3">
                                    {REPORT_FIELDS.map(f => (
                                        <div key={f.id} className="glass-panel neon-fuchsia p-3 text-left font-bold">
                                            <label className="text-[9px] font-black text-fuchsia-400 uppercase tracking-widest mb-1 block flex items-center gap-2 font-bold font-mono"><IconActivity /> {f.label}</label>
                                            <textarea value={String(reportData[f.id] || '')} onChange={e => {
                                                const newReportData = { ...reportData, [f.id]: e.target.value };
                                                setReportData(newReportData);
                                                const allReports = loadFromStorage(STORAGE_KEYS.REPORTS, {});
                                                allReports[selectedDate] = newReportData;
                                                saveToStorage(STORAGE_KEYS.REPORTS, allReports);
                                            }} className="w-full bg-transparent border-none text-xs text-white h-14 outline-none resize-none font-bold" placeholder="..." />
                                        </div>
                                    ))}
                                </div>
                                <div className="glass-panel neon-blue p-3 rounded-lg mt-4 text-left flex flex-col">
                                    <label className="text-[9px] font-black text-cyan-400 uppercase tracking-widest mb-2 block flex items-center gap-2 font-mono tracking-widest font-bold"><IconActivity className="inline mr-2"/>Daily Checklist</label>
                                    <div className="flex flex-col gap-1 mb-2">
                                        {checklist.length === 0 && <div className="text-[10px] text-slate-400 italic">No tasks yet for this day.</div>}
                                        {checklist.map((item, idx) => (
                                            <div key={idx} className="flex items-center gap-2 group">
                                                <input type="checkbox" checked={!!item.checked} onChange={e => {
                                                    const updated = checklist.map((it, i) => i === idx ? { ...it, checked: !it.checked } : it);
                                                    setChecklist(updated);
                                                    saveToStorage('reception_checklist_' + selectedDate, updated);
                                                }} />
                                                <span className={`text-[11px] flex-1 ${item.checked ? 'line-through text-slate-500' : ''}`}>{item.text}</span>
                                                <button onClick={() => {
                                                    const updated = checklist.filter((_, i) => i !== idx);
                                                    setChecklist(updated);
                                                    saveToStorage('reception_checklist_' + selectedDate, updated);
                                                }} className="text-rose-400 text-xs font-bold opacity-60 hover:opacity-100">&times;</button>
                                            </div>
                                        ))}
                                    </div>
                                    <form onSubmit={e => {
                                        e.preventDefault();
                                        if (!newChecklistItem.trim()) return;
                                        const updated = [...checklist, { text: newChecklistItem, checked: false }];
                                        setChecklist(updated);
                                        saveToStorage('reception_checklist_' + selectedDate, updated);
                                        setNewChecklistItem('');
                                    }} className="flex gap-1 mb-2">
                                        <input value={newChecklistItem} onChange={e => setNewChecklistItem(e.target.value)} className="flex-1 bg-black border border-cyan-500/30 rounded p-1.5 text-[10px] outline-none text-white font-bold" placeholder="Add task..." />
                                        <button type="submit" className="bg-cyan-600 px-2 rounded text-white font-bold transition-all hover:bg-cyan-500 uppercase font-black tracking-widest">Add</button>
                                    </form>
                                </div>
                                <div className="glass-panel neon-blue p-3 rounded-lg mt-auto text-left flex flex-col h-48">
                                    <label className="text-[9px] font-black text-cyan-400 uppercase tracking-widest mb-2 block flex items-center gap-2 font-mono tracking-widest font-bold"><IconTerminal className="inline mr-2"/>Live Intel Feed</label>
                                    <div className="flex-1 overflow-y-auto space-y-1.5 mb-2 text-[10px] no-scrollbar text-slate-300 font-medium">
                                        {messages.map(m => <div key={m.id}><span className="text-cyan-500 font-black mr-1 uppercase">{String(m.user)}:</span>{String(m.text)}</div>)}
                                        <div ref={chatEndRef} />
                                    </div>
                                    <form onSubmit={e => { 
                                        e.preventDefault(); 
                                        if (chatInput.trim()) { 
                                            const newMessage = { 
                                                id: `msg-${Date.now()}`, 
                                                text: chatInput, 
                                                createdAt: Date.now(), 
                                                user: 'USER' 
                                            };
                                            const updatedMessages = [...messages, newMessage].sort((a,b) => (a.createdAt || 0) - (b.createdAt || 0));
                                            setMessages(updatedMessages);
                                            saveToStorage(STORAGE_KEYS.MESSAGES, updatedMessages);
                                            setChatInput('');
                                            setTimeout(() => chatEndRef.current?.scrollIntoView({ behavior: "smooth" }), 100);
                                        }
                                    }} className="flex gap-1 shrink-0 pt-2 text-left">
                                        <input value={chatInput} onChange={e => setChatInput(e.target.value)} className="flex-1 bg-black border border-cyan-500/30 rounded p-1.5 text-[10px] outline-none text-white font-bold" placeholder="Broadcast..." />
                                        <button type="submit" className="bg-cyan-600 px-2 rounded text-white font-bold transition-all hover:bg-cyan-500 uppercase font-black tracking-widest">OK</button>
                                    </form>
                                </div>
                            </aside>

                            {/* MAIN GRID */}
                            <main className="flex-1 p-8 overflow-y-auto no-scrollbar text-center font-bold">
                                <div className="flex justify-between items-end mb-8 no-print text-left font-bold">
                                    <div className="text-white">
                                        <h2 className="text-5xl font-black uppercase tracking-tighter drop-shadow-[0_0_15px_rgba(255,255,255,0.2)] font-black">
                                            {currentDate.toLocaleDateString(undefined, { month: 'long', year: 'numeric' })}
                                        </h2>
                                        <div className="text-[10px] font-black text-cyan-400 tracking-[0.5em] uppercase mt-1">Matrix Interface Alpha</div>
                                    </div>
                                    <div className="flex gap-4 items-center">
                                        <input value={shiftSearch} onChange={e => setShiftSearch(e.target.value)} placeholder="Search by employee or date" className="bg-black border border-cyan-500/30 text-cyan-400 rounded-xl px-2 py-1 text-xs font-bold ml-2 w-48" />
                                        <div className="flex bg-white/5 rounded-xl border border-white/10 p-1 text-white font-bold">
                                            <button onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1))} className="p-2 hover:text-cyan-400 transition-colors border-r border-white/5 uppercase font-bold text-[10px]"><IconChevronL /></button>
                                            <button onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1))} className="p-2 hover:text-cyan-400 transition-colors uppercase font-bold text-[10px]"><IconChevronR /></button>
                                        </div>
                                        <select value={shiftStatusFilter} onChange={e => setShiftStatusFilter(e.target.value)} className="bg-black border border-cyan-500/30 text-cyan-400 rounded-xl px-2 py-1 text-xs font-bold ml-2">
                                            <option value="all">All</option>
                                            <option value="confirmed">Confirmed</option>
                                            <option value="pending">Pending</option>
                                        </select>
                                        <button onClick={() => window.print()} className="bg-cyan-500 text-black px-6 py-2 rounded-xl font-black text-xs uppercase shadow-lg hover:bg-white transition-all font-bold">Export Matrix</button>
                                        <button
                                            onClick={() => {
                                                // Gather all shifts for the current month
                                                const mIdx = currentDate.getMonth(), yIdx = currentDate.getFullYear();
                                                const total = new Date(yIdx, mIdx + 1, 0).getDate();
                                                let rows = [['Date','Employee','Start','End','Status','Note']];
                                                for (let d = 1; d <= total; d++) {
                                                    const dk = `${yIdx}-${String(mIdx + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                                                    const dayShifts = events[dk] || [];
                                                    dayShifts.forEach(s => {
                                                        rows.push([
                                                            dk,
                                                            staff[s.empId]?.name || s.empId,
                                                            s.start || s.time || '',
                                                            s.end || '',
                                                            s.confirmed ? 'Confirmed' : 'Pending',
                                                            s.note ? s.note.replace(/\n/g, ' ') : ''
                                                        ]);
                                                    });
                                                }
                                                const csv = rows.map(r => r.map(x => '"'+String(x).replace(/"/g,'""')+'"').join(',')).join('\r\n');
                                                const blob = new Blob([csv], { type: 'text/csv' });
                                                const url = URL.createObjectURL(blob);
                                                const a = document.createElement('a');
                                                a.href = url;
                                                a.download = `reception_shifts_${yIdx}_${String(mIdx+1).padStart(2,'0')}.csv`;
                                                document.body.appendChild(a);
                                                a.click();
                                                setTimeout(() => { document.body.removeChild(a); URL.revokeObjectURL(url); }, 100);
                                            }}
                                            className="bg-cyan-700 text-white px-6 py-2 rounded-xl font-black text-xs uppercase shadow-lg hover:bg-cyan-500 transition-all font-bold"
                                        >Export CSV</button>
                                    </div>
                                </div>
                                <div className="grid grid-cols-7 glass-panel overflow-hidden neon-blue rounded-xl font-bold">
                                    {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(d => <div key={d} className="py-4 text-center text-[10px] font-black text-cyan-400/60 uppercase tracking-widest border-b border-white/5 bg-white/[0.02]">{d}</div>)}
                                    {calendarMatrix}
                                </div>
                            </main>
                        </div>
                    </div>

                    {/* MODAL: PERSONNEL */}
                    {isPersonnelModalOpen && (
                        <div className="fixed inset-0 bg-black/98 backdrop-blur-2xl z-[600] flex items-center justify-center p-4">
                            <div className="glass-panel neon-fuchsia p-10 w-full max-w-2xl max-h-[85vh] flex flex-col shadow-2xl rounded-[2rem]">
                                <div className="flex justify-between items-center mb-8 text-fuchsia-400 text-left">
                                    <h3 className="text-3xl font-black uppercase tracking-tighter">Manifest Hub</h3>
                                    <button onClick={() => { setIsPersonnelModalOpen(false); setIsAdminAuth(false); }} className="text-5xl font-light hover:text-white transition-colors">&times;</button>
                                </div>
                                {!isAdminAuth ? (
                                    <form onSubmit={e => { e.preventDefault(); if (adminCode === ADMIN_CODE) setIsAdminAuth(true); }} className="space-y-6 flex-1 flex flex-col justify-center items-center text-center font-bold">
                                        <div className="text-fuchsia-500 font-black text-xl flex items-center gap-3 alert-pulse">Restricted Access<br/><span className="text-[10px] opacity-40 uppercase tracking-widest font-bold font-mono"><IconLock className="inline mr-2"/> Code Required</span></div>
                                        <input type="password" value={adminCode} onChange={e => setAdminCode(e.target.value)} className="w-48 bg-black border border-fuchsia-500/40 rounded-xl p-4 text-center text-3xl text-white outline-none shadow-inner font-black" placeholder="****" autoFocus />
                                        <button type="submit" className="bg-fuchsia-600 px-12 py-3 rounded-xl font-black uppercase text-xs text-white shadow-lg transition-all hover:scale-105 active:scale-95 font-bold tracking-widest">Unlock Manifest</button>
                                    </form>
                                ) : (
                                    <div className="flex flex-col flex-1 overflow-hidden text-left font-bold">
                                        <div className="space-y-4 mb-8 text-white text-left font-bold font-mono">
                                            <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Enroll New Unit</label>
                                            <div className="flex gap-3 items-center">
                                                <input value={newStaffName} onChange={e => setNewStaffName(e.target.value)} className="flex-1 bg-black border border-white/10 rounded-xl p-3 text-sm text-white font-black outline-none focus:border-fuchsia-500 font-bold" placeholder="Identity Label..." />
                                                <input type="color" value={newStaffColor} onChange={e => setNewStaffColor(e.target.value)} className="w-10 h-10 p-0 border-none bg-transparent cursor-pointer" title="Pick color" />
                                                <button onClick={() => { 
                                                    if (!newStaffName.trim()) return; 
                                                    const newId = `staff-${Date.now()}`;
                                                    const color = newStaffColor || '#0891b2';
                                                    const newStaff = { id: newId, name: String(newStaffName), bg: '', color, createdAt: Date.now() };
                                                    const updatedStaff = { ...staff, [newId]: newStaff };
                                                    setStaff(updatedStaff);
                                                    saveToStorage(STORAGE_KEYS.STAFF, updatedStaff);
                                                    setNewStaffName('');
                                                    setNewStaffColor('#0891b2');
                                                }} className="bg-fuchsia-600 px-6 rounded-xl font-black uppercase text-xs text-white shadow-lg transition-all hover:bg-fuchsia-500 font-bold tracking-widest">Enroll</button>
                                            </div>
                                        </div>
                                        <div className="flex-1 overflow-y-auto no-scrollbar space-y-2 pr-2 border-t border-white/5 pt-4 text-white text-left font-bold">
                                            {Object.entries(staff).map(([id, s]) => (
                                                <div key={id} className="flex items-center justify-between p-3 glass-panel neon-blue rounded-xl group border-white/5 transition-all hover:bg-white/[0.03]">
                                                    <div className="flex items-center gap-4 text-left font-bold font-mono">
                                                        <div className="w-3 h-3 rounded-full shadow-white/20" style={{ background: s.color || '#0891b2' }} />
                                                        <span className="font-black uppercase text-sm">{String(s.name)}</span>
                                                        <input type="color" value={s.color || '#0891b2'} onChange={e => {
                                                            const updatedStaff = { ...staff, [id]: { ...s, color: e.target.value } };
                                                            setStaff(updatedStaff);
                                                            saveToStorage(STORAGE_KEYS.STAFF, updatedStaff);
                                                        }} className="w-6 h-6 ml-2 p-0 border-none bg-transparent cursor-pointer" title="Change color" />
                                                    </div>
                                                    <button onClick={() => { 
                                                        if (!confirm("Terminate unit identifier?")) return;
                                                        const updatedStaff = { ...staff };
                                                        delete updatedStaff[id];
                                                        setStaff(updatedStaff);
                                                        saveToStorage(STORAGE_KEYS.STAFF, updatedStaff);
                                                        // Also remove shifts for this staff member
                                                        const updatedEvents = { ...events };
                                                        Object.keys(updatedEvents).forEach(date => {
                                                            updatedEvents[date] = updatedEvents[date].filter(shift => shift.empId !== id);
                                                            if (updatedEvents[date].length === 0) delete updatedEvents[date];
                                                        });
                                                        setEvents(updatedEvents);
                                                        saveToStorage(STORAGE_KEYS.SHIFTS, updatedEvents);
                                                    }} className="text-rose-500 font-black text-[9px] uppercase px-3 py-1 hover:bg-rose-500/10 rounded-lg border border-rose-500/30 font-mono font-bold tracking-widest">PURGE</button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* ASSIGN MODAL */}
                    {isAddModalOpen && (
                        <div className="fixed inset-0 bg-black/90 backdrop-blur-md z-[500] flex items-center justify-center p-4 text-left font-bold text-white">
                            <div className="glass-panel neon-blue p-10 w-full max-w-md shadow-2xl rounded-3xl">
                                <h3 className="text-2xl font-black text-cyan-400 uppercase mb-8 tracking-tighter text-left font-mono font-bold">Deploy Identity</h3>
                                {/* Step 1: Select Employee */}
                                {!window.selectedAddEmpId && (
                                    <div className="grid grid-cols-2 gap-2 mb-8">
                                        {Object.entries(staff).map(([id, s]) => (
                                            <button key={id} onClick={() => { window.selectedAddEmpId = id; window.selectedAddEmpName = s.name; window.selectedAddEmpBg = s.bg; window.selectedAddTime = '08:00'; setIsAddModalOpen(false); setTimeout(() => setIsAddModalOpen(true), 10); }} className={`p-4 rounded-xl text-[14px] font-black uppercase text-white ${s.bg || 'bg-slate-700'} hover:scale-105 transition-all shadow-lg font-black`}>
                                                {String(s.name)}
                                            </button>
                                        ))}
                                    </div>
                                )}
                                {/* Step 2: Enter Shift Time */}
                                {window.selectedAddEmpId && (
                                    <form onSubmit={e => {
                                        e.preventDefault();
                                        const newShift = {
                                            id: `shift-${Date.now()}`,
                                            date: selectedDate,
                                            empId: window.selectedAddEmpId,
                                            start: window.selectedAddStart || '08:00',
                                            end: window.selectedAddEnd || '20:00',
                                            confirmed: true,
                                            createdAt: Date.now()
                                        };
                                        const updatedEvents = { ...events };
                                        if (!updatedEvents[selectedDate]) updatedEvents[selectedDate] = [];
                                        updatedEvents[selectedDate].push(newShift);
                                        setEvents(updatedEvents);
                                        saveToStorage(STORAGE_KEYS.SHIFTS, updatedEvents);
                                        setIsAddModalOpen(false);
                                        window.selectedAddEmpId = null;
                                        window.selectedAddEmpName = null;
                                        window.selectedAddEmpBg = null;
                                        window.selectedAddStart = null;
                                        window.selectedAddEnd = null;
                                    }} className="space-y-6">
                                        <div className="mb-4 flex items-center gap-3">
                                            <div className={`w-4 h-4 rounded-full ${window.selectedAddEmpBg || 'bg-slate-700'} shadow-white/20`} />
                                            <span className="font-black uppercase text-lg">{window.selectedAddEmpName}</span>
                                        </div>
                                        <label className="block text-xs text-cyan-400 font-bold mb-1">Start Time</label>
                                        <input type="time" value={window.selectedAddStart || '08:00'} onChange={e => { window.selectedAddStart = e.target.value; setIsAddModalOpen(false); setTimeout(() => setIsAddModalOpen(true), 10); }} className="w-full bg-black border border-cyan-500/40 rounded-xl p-3 text-center text-lg text-white outline-none shadow-inner font-black" required />
                                        <label className="block text-xs text-cyan-400 font-bold mb-1">End Time</label>
                                        <input type="time" value={window.selectedAddEnd || '20:00'} onChange={e => { window.selectedAddEnd = e.target.value; setIsAddModalOpen(false); setTimeout(() => setIsAddModalOpen(true), 10); }} className="w-full bg-black border border-cyan-500/40 rounded-xl p-3 text-center text-lg text-white outline-none shadow-inner font-black" required />
                                        <div className="flex gap-3 mt-6">
                                            <button type="submit" className="flex-1 bg-cyan-600 py-3 rounded-xl font-black uppercase text-xs text-white shadow-lg transition-all hover:bg-cyan-500 font-bold tracking-widest">Assign Shift</button>
                                            <button type="button" onClick={() => { window.selectedAddEmpId = null; window.selectedAddEmpName = null; window.selectedAddEmpBg = null; window.selectedAddStart = null; window.selectedAddEnd = null; setIsAddModalOpen(false); setTimeout(() => setIsAddModalOpen(true), 10); }} className="flex-1 bg-slate-700 py-3 rounded-xl font-black uppercase text-xs text-white shadow-lg transition-all hover:bg-slate-600 font-bold tracking-widest">Back</button>
                                        </div>
                                    </form>
                                )}
                                <button onClick={() => { setIsAddModalOpen(false); window.selectedAddEmpId = null; window.selectedAddEmpName = null; window.selectedAddEmpBg = null; window.selectedAddTime = null; }} className="w-full text-slate-600 text-[10px] font-black uppercase tracking-[0.2em] pt-6 text-center hover:text-white transition-colors underline font-bold tracking-widest">Cancel deployment</button>
                            </div>
                        </div>
                    )}

                    {/* EDIT MODAL */}
                    {editingShift && (
                        <div className="fixed inset-0 bg-black/90 backdrop-blur-md z-[500] flex items-center justify-center p-4">
                            <div className="glass-panel neon-fuchsia p-8 w-full max-w-sm shadow-2xl rounded-3xl text-left font-bold text-white">
                                <h3 className="text-xl font-black uppercase mb-8 text-center text-white tracking-tighter font-bold font-mono tracking-widest">Adjust Link</h3>
                                <form onSubmit={e => {
                                    e.preventDefault();
                                    const updatedEvents = { ...events };
                                    const dateShifts = updatedEvents[editingShift.date] || [];
                                    const shiftIndex = dateShifts.findIndex(s => s.id === editingShift.id);
                                    if (shiftIndex !== -1) {
                                        dateShifts[shiftIndex] = {
                                            ...dateShifts[shiftIndex],
                                            start: window.editingShiftStart || editingShift.start || '',
                                            end: window.editingShiftEnd || editingShift.end || '',
                                            note: window.editingShiftNote !== undefined ? window.editingShiftNote : (editingShift.note || ''),
                                            confirmed: editingShift.confirmed
                                        };
                                        updatedEvents[editingShift.date] = dateShifts;
                                        setEvents(updatedEvents);
                                        setEditingShift({ ...editingShift, time: window.editingShiftTime || editingShift.time, note: window.editingShiftNote !== undefined ? window.editingShiftNote : (editingShift.note || '') });
                                        saveToStorage(STORAGE_KEYS.SHIFTS, updatedEvents);
                                    }
                                    window.editingShiftStart = null;
                                    window.editingShiftEnd = null;
                                    window.editingShiftNote = null;
                                    setEditingShift(null);
                                }} className="space-y-6 text-center font-bold">
                                    <button type="button" onClick={() => { 
                                        const updatedEvents = { ...events };
                                        const dateShifts = updatedEvents[editingShift.date] || [];
                                        const shiftIndex = dateShifts.findIndex(s => s.id === editingShift.id);
                                        if (shiftIndex !== -1) {
                                            dateShifts[shiftIndex] = { ...dateShifts[shiftIndex], confirmed: !editingShift.confirmed };
                                            updatedEvents[editingShift.date] = dateShifts;
                                            setEvents(updatedEvents);
                                            setEditingShift({ ...editingShift, confirmed: !editingShift.confirmed });
                                            saveToStorage(STORAGE_KEYS.SHIFTS, updatedEvents);
                                        }
                                    }} className={`w-full py-4 rounded-xl font-black text-xs uppercase transition-all ${editingShift.confirmed ? 'bg-cyan-600 text-white shadow-[0_0_15px_rgba(6,182,212,0.4)]' : 'bg-rose-600 text-white shadow-[0_0_15px_rgba(225,29,72,0.4)]'}`}>{editingShift.confirmed ? 'Link: Verified' : 'Link: Lost'}</button>
                                    <div className="text-left">
                                        <label className="block text-xs text-fuchsia-400 font-bold mb-1">Start Time</label>
                                        <input type="time" defaultValue={editingShift.start || ''} onChange={e => { window.editingShiftStart = e.target.value; }} className="w-full bg-black border border-fuchsia-500/40 rounded-xl p-3 text-center text-lg text-white outline-none shadow-inner font-black mb-4" required />
                                        <label className="block text-xs text-fuchsia-400 font-bold mb-1">End Time</label>
                                        <input type="time" defaultValue={editingShift.end || ''} onChange={e => { window.editingShiftEnd = e.target.value; }} className="w-full bg-black border border-fuchsia-500/40 rounded-xl p-3 text-center text-lg text-white outline-none shadow-inner font-black mb-4" required />
                                        <label className="block text-xs text-fuchsia-400 font-bold mb-1">Shift Note</label>
                                        <textarea defaultValue={editingShift.note || ''} onChange={e => { window.editingShiftNote = e.target.value; }} className="w-full bg-black border border-fuchsia-500/40 rounded-xl p-3 text-left text-base text-white outline-none shadow-inner font-bold min-h-[60px]" placeholder="Optional note..." />
                                    </div>
                                    <div className="flex gap-3 font-bold">
                                        <button type="submit" className="flex-1 bg-white text-black py-4 rounded-xl font-black uppercase text-xs hover:bg-cyan-400 transition-colors shadow-lg font-bold tracking-widest">Commit</button>
                                        <button type="button" onClick={() => { 
                                            if (!confirm("Terminate link?")) return;
                                            const updatedEvents = { ...events };
                                            const dateShifts = updatedEvents[editingShift.date] || [];
                                            updatedEvents[editingShift.date] = dateShifts.filter(s => s.id !== editingShift.id);
                                            if (updatedEvents[editingShift.date].length === 0) delete updatedEvents[editingShift.date];
                                            setEvents(updatedEvents);
                                            saveToStorage(STORAGE_KEYS.SHIFTS, updatedEvents);
                                            setEditingShift(null);
                                        }} className="bg-rose-600 px-8 py-4 rounded-xl text-white hover:bg-rose-500 shadow-lg font-bold">Remove</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
